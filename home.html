<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>DMS Â· Gemello Digitale del Commercio â€” Home</title>
<meta name="color-scheme" content="dark">
<style>
  :root{
    --bgA:#0e2d38; --bgB:#155268;
    --ink:#dde2e4; --accent:#46a0bd;
    --panel:#0b2128; --glass:rgba(255,255,255,.08);
    --btnW:clamp(92px, 11vmin, 150px);
    --r:16px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; color:var(--ink);
    background: radial-gradient(1200px 800px at 60% 20%, #1a566b 0%, transparent 60%),
                linear-gradient(180deg, var(--bgB), var(--bgA));
    font:16px/1.45 system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
    overflow:hidden;
  }

  /* Testata */
  .brand{
    position:fixed; right:24px; top:28px; text-align:right; z-index:5;
    letter-spacing:.02em; line-height:1.1; margin:0;
  }
  .brand b{display:block; font-size:28px}
  .brand small{opacity:.85; display:block; margin-top:6px}

  /* Toolbar */
  .toolbar{position:fixed; left:20px; top:20px; display:flex; gap:10px; z-index:5}
  .btn{
    appearance:none; border:2px solid rgba(255,255,255,.2);
    background:linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.04));
    color:var(--ink); padding:.55rem .9rem; border-radius:12px; font-weight:700;
    backdrop-filter:blur(6px); text-decoration:none; cursor:pointer;
    transition:transform .15s ease, box-shadow .15s ease;
  }
  .btn:hover{ transform:translateY(-1px); box-shadow:0 8px 20px rgba(0,0,0,.25) }
  .btn:focus-visible{ outline:2px solid var(--accent); outline-offset:2px }

  /* Layering sicuro */
  #glowLayer{ position:fixed; inset:0; z-index:1; pointer-events:none; overflow:hidden; }
  #ellipseLayer{position:fixed; inset:0; z-index:2; pointer-events:none}
  .tick{ stroke:rgba(220,245,255,.6); stroke-width:2; stroke-linecap:round }
  .center-dot{ fill:rgba(255,255,255,.8) }
  #hand{ stroke:#fff; stroke-width:3; stroke-linecap:round }
  #handTip{ fill:rgba(255,255,255,.95) }
  
  #viewport{
    position:fixed; z-index:3; border-radius:20px; overflow:hidden;
    border:2px solid rgba(255,255,255,.25);
    background:rgba(0,0,0,.28); box-shadow:0 18px 40px rgba(0,0,0,.45);
  }
  /* Disattiva qualunque glow preesistente del video */
  #viewport::before, #viewport::after { content:none !important; }
  #viewport video,#viewport iframe{width:100%; height:100%; display:block; border:0}

  /* 12 nodi con glow */
  .node{
    position:fixed; width:var(--btnW); height:var(--btnW); z-index:4;
    border-radius:var(--r); border:2px solid rgba(190,230,240,.95);
    background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
    display:grid; place-items:center; color:var(--ink);
    box-shadow:0 10px 22px rgba(0,0,0,.28), inset 0 0 0 0 rgba(255,255,255,.15);
    backdrop-filter:blur(4px); transition:transform .15s ease, box-shadow .15s ease;
    pointer-events:auto;
  }
  .node::before{
    content:""; position:absolute; inset:-16px; border-radius:20px;
    background: radial-gradient(60% 60% at 50% 50%, rgba(70,160,189,.30), transparent 70%);
    opacity:0; filter:blur(12px); pointer-events:none; transition:opacity .15s ease;
  }
  .node span{font-weight:700; opacity:.9}
  .node:hover, .node:focus-visible{ transform:translateY(-2px); }
  .node:hover::before, .node:focus-visible::before{ opacity:1; }
  .node:focus-visible{ outline:2px solid var(--accent); outline-offset:2px }

  /* --- Glow HOVER/FOCUS dei 12 pulsanti --- */
  .node{
    position: fixed;                  /* giÃ  presente, lo reiteriamo senza conflitti */
    border-radius: 16px;
    transition: transform .15s ease, box-shadow .15s ease, border-color .15s ease;
  }

  .node::after{
    content:"";
    position:absolute; inset:-2px;    /* sottile alone che "sborda" un filo */
    border-radius: inherit;
    pointer-events:none;
    background: radial-gradient(120px 120px at 50% 60%, rgba(70,160,189,.35), transparent 60%);
    opacity: 0;                        /* invisibile finchÃ© non si passa sopra */
    transition: opacity .15s ease;
  }

  /* Hover (mouse) e focus (tastiera/touch) */
  .node:hover,
  .node:focus-visible{
    transform: translateY(-2px);
    box-shadow:
      0 12px 28px rgba(0,0,0,.30),      /* ombra sotto */
      0 0 22px rgba(70,160,189,.55);    /* glow teal */
    border-color: rgba(190,230,240,.95);
  }

  .node:hover::after,
  .node:focus-visible::after{
    opacity: 1;
  }

  /* AccessibilitÃ  focus chiaro e visibile */
  .node:focus-visible{
    outline: 2px solid rgba(70,160,189,.8);
    outline-offset: 3px;
  }

  /* Mini controlli nel viewport */
  .vp-actions{
    position:absolute; right:10px; bottom:10px; display:flex; gap:8px; z-index:10;
  }
  .vp-actions .chip{
    font-weight:700; padding:.45rem .6rem; border-radius:10px; cursor:pointer;
    border:1px solid rgba(255,255,255,.25); background:var(--glass);
  }

  @media (max-width:820px){
    .brand b{font-size:22px}
  }

  /* OFF: retro-illuminazione del video */
  #viewport::before,
  #viewport::after,
  .video-glow,
  #videoGlow { display: none !important; content: none !important; }

  /* Conferma layering e ombra neutra del riquadro */
  #ellipseLayer { z-index: 2; pointer-events: none; }
  #viewport     { z-index: 3; box-shadow: 0 18px 40px rgba(0,0,0,.40); }
  .node         { z-index: 4; backdrop-filter: blur(2px); }
</style>
<link rel="icon" href="data:,">
<link rel="stylesheet" href="./assets/theme-green.css">
<!-- THEME GREEN OVERRIDE (safe, removable) -->
<style id="theme-green">
  :root{
    /* Fondo: verde scuro elegante */
    --bg-a:#071a1d;
    --bg-b:#0b2730;
    /* Testi */
    --ink:#e8fbff;
    --muted:#9bd6de;
    /* Pannelli e bordi */
    --panel:rgba(7,26,29,.78);
    --stroke:rgba(173,234,240,.18);
    /* Accenti */
    --accent:#14b8a6;
    --accent2:#0b5fff;
  }
  /* Forziamo lo sfondo a usare le variabili sopra */
  body{
    background:
      radial-gradient(1200px 800px at 20% -10%, rgba(20,184,166,.08), transparent 60%),
      linear-gradient(180deg, var(--bg-b), var(--bg-a)) !important;
  }

  /* Layering di pagina (conferma) */
  #glowLayer { z-index:1; pointer-events:none; }
  #ellipseLayer { z-index:2; pointer-events:none; }
  #viewport { z-index:3; }
  .node { z-index:4; }

  /* Base tasto: testo NEUTRO a riposo */
  .node{
    position: relative;
    isolation: isolate;     /* per gestire gli pseudo-livelli interni */
    overflow: visible;      /* il glow puÃ² "sbordare" */
  }

  /* GLOW SOTTO al contenuto del tasto (nessun layer aggiuntivo) */
  .node::before{
    content:"";
    position:absolute; inset:-10px;
    border-radius:20px;
    z-index:-1;             /* sotto al contenuto del tasto */
    opacity:0;              /* solo in hover */
    /* glow forte + bordo colorato */
    box-shadow:
      0 0 0 6px var(--hc),
      0 0 40px 0 var(--hc),
      0 10px 36px rgba(0,0,0,.55);
    transition: opacity .15s ease;
  }

  /* Bordo brillante in hover (anello) + lieve sollevamento */
  .node:hover{
    box-shadow:
      inset 0 0 0 2px rgba(255,255,255,.35),
      0 0 0 4px var(--hc);
    transform: translateY(-2px);
  }

  /* Attiva il glow sotto */
  .node:hover::before{ opacity:1; }

  /* Testo: neutro a riposo, si illumina del colore del tasto in hover */
  .node span{
    /* Mantieni il colore NEUTRO ATTUALE del tema */
    text-shadow: none;
    transition: color .15s ease, text-shadow .15s ease;
  }
  .node:hover span{
    color:#ffffff;
    text-shadow:
      0 0 10px var(--hc),
      0 0 18px rgba(255,255,255,.35);
  }

  /* Spotlight ottimizzato */
  #glowLayer{
    pointer-events:none;
    background:
      radial-gradient(240px 240px at var(--mx,50%) var(--my,50%),
        rgba(20,184,166,.25), transparent 60%);
  }

  /* Disattiva spotlight su mobile per performance */
  @media (hover:none) and (pointer:coarse){ 
    #glowLayer{display:none} 
  }
</style>
</head>
<body>
  <div id="glowLayer" aria-hidden="true"></div> <!-- spotlight mouse -->

  <p class="brand">
    <b>GEMELLO DIGITALE</b>
    <b>DEL COMMERCIO</b>
    <small>DMS â€¢ Orologio roadmap</small>
  </p>

  <div class="toolbar">
    <a class="btn" href="./index.html">ðŸŽ¬ Spot</a>
    <a class="btn" href="./mindmap.html">ðŸ§  Mappa</a>
  </div>

  <svg id="ellipseLayer" aria-hidden="true"></svg>
  <div id="viewport" role="region" aria-label="contenuto centrale"></div>

<script>
(() => {
  const S = {nodes:12, tries:10, retryMs:300};
  let viewport, svg, heroPlaying=false, mods=null;

  // --- Helpers --------------------------------------------------------------
  const $ = sel => document.querySelector(sel);
  const el = (tag, attrs={}) => Object.assign(document.createElement(tag), attrs);

  function makeNodes(){
    const frag = document.createDocumentFragment();
    for(let i=0;i<S.nodes;i++){
      const b = el('button',{className:'node','aria-label':`Apri PDF ${i+1}`});
      b.innerHTML = '<span>PDF</span>';
      b.dataset.i = i;
      frag.appendChild(b);
    }
    document.body.appendChild(frag);
  }

  async function loadModules(){
    if(mods) return mods;
    try{
      const r = await fetch('./data/modules.json');
      if(!r.ok) throw new Error(r.status);
      mods = await r.json();
    }catch(e){
      console.warn('modules.json non disponibile:', e);
      mods = []; // fallback: nessun blocco
    }
    return mods;
  }

  function ensureHero(){
    if(!viewport) return;
    // se c'Ã¨ giÃ  un media, non raddoppiare
    if(viewport.querySelector('video,iframe')) return;
    viewport.innerHTML = '';
    const v = el('video',{
      muted:true, autoplay:true, loop:true, playsInline:true,
      src:'./videos/video-hero.mp4',
      poster:'./assets/poster-hero.jpg'
    });
    v.setAttribute('webkit-playsinline','');
    v.preload = 'metadata';

    // retry robusto per iOS
    const tryPlay = async (n=0) => {
      try{
        await v.play();
        heroPlaying=true;
      }catch{
        if(n < S.tries){
          setTimeout(()=>tryPlay(n+1), S.retryMs);
        }else{
          // fallback
          v.src = './videos/teaser-hub-dms.mp4';
          v.load(); setTimeout(()=>tryPlay(n+1), S.retryMs);
        }
      }
    };
    v.addEventListener('loadeddata', ()=>{ if(!heroPlaying) tryPlay(); });
    viewport.appendChild(v);
    tryPlay();
  }

  function viewportPanel(mod){
    const box = el('div');
    box.style = "position:relative;width:100%;height:100%";
    const iframe = el('iframe',{src:mod.pdf, title:mod.title||'Documento'});
    iframe.loading = 'lazy';
    box.appendChild(iframe);

    const actions = el('div',{className:'vp-actions'});
    const open = el('a',{className:'chip',textContent:'Apri in nuova scheda', target:'_blank', rel:'noopener', href:mod.pdf});
    const back = el('button',{className:'chip',textContent:'Torna al video'});
    back.onclick = () => { viewport.innerHTML=''; heroPlaying=false; ensureHero(); };
    actions.append(open, back);
    box.appendChild(actions);

    viewport.innerHTML=''; viewport.appendChild(box);
  }

  function bindNodes(){
    document.querySelectorAll('.node').forEach(btn=>{
      btn.addEventListener('click', async ()=>{
        const i = +btn.dataset.i;
        const list = await loadModules();
        const mod = list[i];
        if(mod && mod.pdf){
          viewportPanel(mod);
        }else{
          viewport.innerHTML = '<div style="display:grid;place-items:center;height:100%;font-weight:800;color:#cfe8f0">Â· presto</div>';
        }
      });
    });
  }

  function layout(){
    viewport = $('#viewport'); svg = $('#ellipseLayer');
    const W=innerWidth, H=innerHeight, cx=W/2, cy=H*0.50;

    // dimensione nodi
    const btnW = Math.max(92, Math.min(Math.round(W*0.10), 150));
    document.documentElement.style.setProperty('--btnW', btnW+'px');

    // ellisse calcolata per non tagliare i nodi
    const margin=24;
    const a = Math.min(W/2 - margin - btnW/2, W*0.46);
    const b = Math.min(H/2 - margin - btnW/2, H*0.36);

    // viewport 16:9 dentro ellisse interna
    const innerA=a-btnW*0.60, innerB=b-btnW*0.60;
    let vw=W*0.62, vh=vw*9/16, maxH=H*0.44;
    if(vh>maxH){ vh=maxH; vw=vh*16/9; }
    let k=1;
    while(((((vw*k)/2)**2)/(innerA**2) + (((vh*k)/2)**2)/(innerB**2))>1 && k>0.4){ k-=0.02; }
    vw*=k; vh*=k;
    viewport.style.cssText = `width:${vw}px;height:${vh}px;left:${cx-vw/2}px;top:${cy-vh/2}px`;

    // ellisse con tacche
    svg.setAttribute('viewBox',`0 0 ${W} ${H}`); svg.innerHTML='';
    const g = document.createElementNS('http://www.w3.org/2000/svg','g'); svg.appendChild(g);
    for(let i=0;i<12;i++){
      const t = -Math.PI/2 + 2*Math.PI*i/12;
      const ix=cx+(a-18)*Math.cos(t), iy=cy+(b-18)*Math.sin(t);
      const ex=cx+a*Math.cos(t),      ey=cy+b*Math.sin(t);
      const ln=document.createElementNS('http://www.w3.org/2000/svg','line');
      ln.setAttribute('x1',ix); ln.setAttribute('y1',iy); ln.setAttribute('x2',ex); ln.setAttribute('y2',ey);
      ln.setAttribute('class','tick'); g.appendChild(ln);
    }
    const c=document.createElementNS('http://www.w3.org/2000/svg','circle');
    c.setAttribute('cx',cx); c.setAttribute('cy',cy); c.setAttribute('r',10); c.setAttribute('class','center-dot'); g.appendChild(c);
    const hand=document.createElementNS('http://www.w3.org/2000/svg','line');
    hand.id='hand'; hand.setAttribute('x1',cx); hand.setAttribute('y1',cy); hand.setAttribute('x2',cx); hand.setAttribute('y2',cy);
    hand.setAttribute('stroke','rgba(255,255,255,.9)'); hand.setAttribute('stroke-width','3'); hand.setAttribute('stroke-linecap','round');
    g.appendChild(hand);

    // âœ… NUOVO: puntale triangolare
    const handTip = document.createElementNS('http://www.w3.org/2000/svg','polygon');
    handTip.id = 'handTip';
    handTip.setAttribute('fill','rgba(255,255,255,.95)');
    g.appendChild(handTip);

    // posiziona i 12 nodi
    document.querySelectorAll('.node').forEach((el,i)=>{
      const t = -Math.PI/2 + 2*Math.PI*i/12;
      el.style.left = (cx + a*Math.cos(t) - btnW/2)+'px';
      el.style.top  = (cy + b*Math.sin(t) - btnW/2)+'px';
    });

    // animazione lancetta (rispetta prefers-reduced-motion)
    const prefers = matchMedia('(prefers-reduced-motion: reduce)').matches;
    if(!prefers){
      let start=null;
      const anim = ts=>{
        if(!start) start=ts;
        const T=12000, th=-Math.PI/2 + 2*Math.PI*((ts-start)%T)/T;
        const px = cx + a*Math.cos(th)*0.95; // punta linea
        const py = cy + b*Math.sin(th)*0.95;
        hand.setAttribute('x2', px);
        hand.setAttribute('y2', py);
        
        // âœ… NUOVO: geometria del triangolo
        const baseX = cx + a * Math.cos(th) * 0.86; // base triangolo arretrata lungo la lancetta
        const baseY = cy + b * Math.sin(th) * 0.86;
        const nx = -Math.sin(th), ny = Math.cos(th); // normale per larghezza
        const half = 10; // metÃ  larghezza del puntale
        
        // punti: punta + vertice base dx + vertice base sx
        handTip.setAttribute(
          'points',
          `${px},${py} ${baseX + nx*half},${baseY + ny*half} ${baseX - nx*half},${baseY - ny*half}`
        );
        
        requestAnimationFrame(anim);
      };
      requestAnimationFrame(anim);
    }
  }

  // Spotlight mouse/touch in background (non prende click)
  function initSpotlight() {
    const gl = document.getElementById('glowLayer');
    gl.innerHTML = '';
    const spot = document.createElement('div');
    spot.style.cssText = `
      position:absolute; left:50%; top:50%;
      width:60vmin; height:60vmin; border-radius:50%;
      background: radial-gradient(circle at center,
                  rgba(70,160,189,.35) 0%,
                  rgba(70,160,189,.20) 35%,
                  transparent 60%);
      filter: blur(40px); opacity:.35; transform: translate(-50%,-50%);
      will-change: transform,left,top;
    `;
    gl.appendChild(spot);

    function moveGlow(x,y){ spot.style.left = x+'px'; spot.style.top = y+'px'; }
    // Spotlight ottimizzato con rAF
    let mx=0,my=0,pending=false;
    const glow=document.getElementById('glowLayer');
    addEventListener('pointermove', e => { 
      mx=e.clientX; my=e.clientY; 
      if(!pending){ 
        pending=true; 
        requestAnimationFrame(()=>{ 
          glow.style.setProperty('--mx', mx+'px'); 
          glow.style.setProperty('--my', my+'px'); 
          pending=false; 
        }); 
      } 
    }, {passive:true});
  }

  // Rimuove esplicitamente tutte le variabili --hc per reset completo
  function resetAllHoverColors(){
    document.querySelectorAll('.node').forEach((n,i)=>{
      n.style.removeProperty('--hc');
    });
    console.log('Reset completo: rimosse tutte le variabili --hc personalizzate');
  }

  // bootstrap
  document.addEventListener('DOMContentLoaded', ()=>{
    makeNodes(); 
    layout(); 
    ensureHero(); 
    bindNodes(); 
    initSpotlight(); 
    
    // Reset completo con timeout per assicurare che i nodi siano pronti
    setTimeout(() => {
      resetAllHoverColors();
    }, 100);
  });
  addEventListener('resize', layout);
  addEventListener('pageshow', ensureHero);
  document.addEventListener('visibilitychange', ()=>{ if(!document.hidden){ ensureHero(); }});
})();
</script>
</body>
</html>

