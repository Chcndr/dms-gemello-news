<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>DMS â€¢ Orologio roadmap</title>
  <link rel="icon" href="data:,">
  <style>
    :root{
      --bg1:#071a1d; --bg2:#0b2730;
      --ink:#e8fbff; --ink-2:#9bd6de;
      --accent:#14b8a6;
      --hc:#23b5a6; /* hover color default */
      
      /* scala armonica: rosso â†’ arancio â†’ giallo â†’ giallo-verde â†’ verde */
      --hc0:#e11d48;  /* rosso acceso */
      --hc1:#f97316;  /* arancio intenso */
      --hc2:#fb923c;  /* arancio chiaro */
      --hc3:#fbbf24;  /* ambra */
      --hc4:#eab308;  /* giallo scuro */
      --hc5:#d9f000;  /* giallo pieno */
      --hc6:#bde34a;  /* giallo-verde */
      --hc7:#9bdc4b;  /* verde-giallo */
      --hc8:#66c653;  /* verde medio */
      --hc9:#36b24a;  /* verde intenso */
      --hc10:#22a866; /* verde con punta teal */
      --hc11:#21c55d; /* verde acceso (finale) */
    }

    /* fondo */
    html,body{height:100%;margin:0}
    body{
      background: radial-gradient(1400px 900px at 50% 20%, #0f3640 0%, var(--bg1) 35%, var(--bg2) 100%);
      color:var(--ink); font: 16px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      overflow:hidden;
    }

    /* nav+claim */
    .top{position:fixed; left:16px; top:16px; display:flex; gap:10px; z-index:10}
    .btn{
      padding:.55rem .9rem; border-radius:14px; border:1.5px solid rgba(255,255,255,.22);
      background: rgba(255,255,255,.06); backdrop-filter: blur(6px);
      text-decoration:none; color:var(--ink); font-weight:600
    }
    .claim{position:fixed; right:20px; top:26px; text-align:right; z-index:10}
    .claim h1{margin:0 0 6px; letter-spacing:.02em; font-size:32px; line-height:1.1}
    .claim p{margin:0; color:var(--ink-2); font-weight:500}

    /* LAYER BLINDATI - lancetta corretta */
    #glowLayer   { position:fixed; inset:0; z-index:1; pointer-events:none; }
    #ellipseLayer{ position:fixed; inset:0; z-index:2; pointer-events:none; }
    #handLayer   { position:fixed; inset:0; z-index:2; pointer-events:none; }
    #viewport    { position:fixed;           z-index:3; }
    .node        { position:fixed; left:0; top:0; z-index:4; }

    /* Video */
    #viewport{
      display:flex; align-items:center; justify-content:center;
    }
    #viewport > video{
      width:100%; height:100%; object-fit:cover; border-radius:16px;
      box-shadow: 0 24px 60px rgba(0,0,0,.35), 0 0 0 1px rgba(255,255,255,.08) inset;
      background:#0c1e25;
    }

    /* Pulsanti base */
    .node{
      width:140px; height:140px;
      border-radius:16px; background: rgba(255,255,255,.06);
      border:2px solid rgba(255,255,255,.55);
      box-shadow: 0 12px 30px rgba(0,0,0,.35), inset 0 0 0 1px rgba(255,255,255,.10);
      color:var(--ink); font-weight:600; letter-spacing:.02em;
      display:grid; place-items:center;
      transition: transform .18s ease, box-shadow .18s ease, border-color .18s ease;
      will-change: transform;
    }
    .tag{opacity:.9}

    /* hover con colore variabile */
    .node:is(:hover,:focus-visible){
      border-color: color-mix(in srgb, var(--hc) 90%, white 10%);
      box-shadow:
        0 0 0 6px color-mix(in srgb, var(--hc) 65%, transparent 35%),
        0 0 28px color-mix(in srgb, var(--hc) 80%, transparent 20%),
        0 0 1px rgba(0,0,0,.4) inset;
      transform: translateY(-2px);
    }

    /* spotlight leggero che segue il mouse */
    #glowLayer{
      background:
        radial-gradient(240px 240px at var(--mx,50%) var(--my,50%),
          rgba(20,184,166,.22), transparent 60%);
    }

    /* Puntale lancetta */
    .hand-tip{
      width:10px; height:10px; border-radius:50%;
      background:#e8fbff; box-shadow:0 0 12px rgba(232,251,255,.35);
      pointer-events:none;
    }

    /* Stili lancetta SVG */
    #handLayer .hand-shaft{
      stroke:#cde6df; stroke-width:3; stroke-linecap:round;
      vector-effect:non-scaling-stroke;
      filter: drop-shadow(0 1px 2px rgba(0,0,0,.45));
    }
    #handLayer .hand-tip{
      fill:#cde6df; 
      filter: drop-shadow(0 1px 2px rgba(0,0,0,.45));
    }
    #handLayer .hand-hub{
      fill:#d9ece7; stroke:rgba(0,0,0,.35); stroke-width:1;
    }
  </style>
</head>
<body>
  <!-- Nav -->
  <nav class="top">
    <a class="btn" href="../index.html">ðŸŽ¬ Spot</a>
    <a class="btn" href="../mindmap.html">ðŸ§  Mappa</a>
  </nav>

  <!-- Claim -->
  <header class="claim">
    <h1>GEMELLO DIGITALE<br>DEL COMMERCIO</h1>
    <p>DMS â€¢ Orologio roadmap</p>
  </header>

  <!-- Layers -->
  <svg id="ellipseLayer" aria-hidden="true">
    <line id="handLine" x1="50%" y1="52%" x2="50%" y2="52%" 
          stroke="#e8fbff" stroke-width="2" opacity="0.8"/>
  </svg>
  <svg id="handLayer" aria-hidden="true"></svg>
  <div id="viewport" aria-label="contenuti">
    <video id="hero" src="../videos/video-hero.mp4"
      muted playsinline webkit-playsinline preload="metadata" autoplay loop
      poster="../assets/poster-hero.jpg"></video>
  </div>
  <div id="glowLayer" aria-hidden="true"></div>

  <!-- 12 pulsanti ore 0..11 -->
  <button class="node" data-i="0"><span class="tag">PDF</span></button>
  <button class="node" data-i="1"><span class="tag">PDF</span></button>
  <button class="node" data-i="2"><span class="tag">PDF</span></button>
  <button class="node" data-i="3"><span class="tag">PDF</span></button>
  <button class="node" data-i="4"><span class="tag">PDF</span></button>
  <button class="node" data-i="5"><span class="tag">PDF</span></button>
  <button class="node" data-i="6"><span class="tag">PDF</span></button>
  <button class="node" data-i="7"><span class="tag">PDF</span></button>
  <button class="node" data-i="8"><span class="tag">PDF</span></button>
  <button class="node" data-i="9"><span class="tag">PDF</span></button>
  <button class="node" data-i="10"><span class="tag">PDF</span></button>
  <button class="node" data-i="11"><span class="tag">PDF</span></button>

  <!-- Puntale lancetta -->
  <div id="handTip" class="hand-tip" aria-hidden="true"></div>

  <script>
    (function(){
      const RATIO = 16/9;
      const BTN   = 140;
      const SAFE  = 48;
      const N     = 12;

      function clamp(v,min,max){ return Math.max(min, Math.min(max, v)); }

      function layout(){
        const W  = innerWidth, H = innerHeight;
        const cx = W * 0.50;
        const cy = H * 0.52;

        // Spazio utile per i NODI dal centro ai bordi
        const Aroom = Math.min(cx, W-cx) - (SAFE + BTN/2);
        const Broom = Math.min(cy, H-cy) - (SAFE + BTN/2);

        // Dimensioni video massime
        let vhMaxFromNodes = 2 * (Broom - (BTN/2 + SAFE));
        let vwMaxFromNodes = 2 * (Aroom - (BTN/2 + SAFE));

        const vhMaxSoft = H * 0.40;
        const vwMaxSoft = W * 0.58;

        let vh = clamp(vhMaxFromNodes, 180, vhMaxSoft);
        let vw = Math.min(vh * RATIO, vwMaxSoft, vwMaxFromNodes);

        if (vw > vwMaxFromNodes) {
          vw = vwMaxFromNodes;
          vh = vw / RATIO;
        }

        // Riduci se serve piÃ¹ spazio ai nodi
        for (let k=0; k<8; k++){
          const topClear    = (cy - vh/2) - (SAFE + BTN/2);
          const bottomClear = (H - (cy + vh/2)) - (SAFE + BTN/2);
          if (Math.min(topClear, bottomClear) >= BTN*0.75) break;
          vh *= 0.90; vw = vh * RATIO;
        }

        // Applica il video centrato
        const vp = document.getElementById('viewport');
        vp.style.width  = vw + 'px';
        vp.style.height = vh + 'px';
        vp.style.left   = (cx - vw/2) + 'px';
        vp.style.top    = (cy - vh/2) + 'px';

        // Semi-assi ellisse OVALE: laterali quasi a bordo, verticali equilibrati
        const GAP = 80; // spazio tra video e pulsanti verticali
        const a = (W/2) - SAFE - (BTN/2); // semiasse orizzontale massimo
        const b = (vh/2) + GAP + (BTN/2);  // semiasse verticale equilibrato

        // Posiziona i 12 pulsanti
        const nodes = document.querySelectorAll('.node');
        nodes.forEach((el, i) => {
          const t = -Math.PI/2 + (2*Math.PI*i)/N;
          const x = cx + a * Math.cos(t) - BTN/2;
          const y = cy + b * Math.sin(t) - BTN/2;
          el.style.transform = `translate(${Math.round(x)}px,${Math.round(y)}px)`;
        });
      }

      layout();
      addEventListener('resize', layout, {passive:true});
      addEventListener('pageshow', layout);
    })();

    // spotlight mouse
    (function(){
      const glow = document.getElementById('glowLayer');
      let mx=0, my=0, ticking=false;
      addEventListener('pointermove', e => {
        mx=e.clientX; my=e.clientY;
        if(!ticking){
          requestAnimationFrame(()=>{ 
            glow.style.setProperty('--mx', mx+'px');
            glow.style.setProperty('--my', my+'px');
            ticking=false;
          });
          ticking=true;
        }
      }, {passive:true});
    })();

    // Puntale lancetta animato con asta - RIMOSSO (sostituito da handLayer)
  </script>

  <script>
    // Lancetta orologio corretta (sotto il video, asta + puntale)
    (() => {
      // ----- costruzione SVG
      const svg = document.getElementById('handLayer');
      const NS = 'http://www.w3.org/2000/svg';
      const g = document.createElementNS(NS, 'g');        // gruppo rotante
      const shaft = document.createElementNS(NS, 'line');  // asta
      const tip = document.createElementNS(NS, 'polygon'); // puntale triangolo
      const hub = document.createElementNS(NS, 'circle');  // perno centrale

      shaft.setAttribute('class','hand-shaft');
      tip.setAttribute('class','hand-tip');
      hub.setAttribute('class','hand-hub'); hub.setAttribute('r','4');

      g.appendChild(shaft); g.appendChild(tip); g.appendChild(hub);
      svg.appendChild(g);

      // ----- utilitÃ 
      function placeSvg() {
        // grandezza SVG = viewport pieno
        svg.setAttribute('width', innerWidth);
        svg.setAttribute('height', innerHeight);
        svg.setAttribute('viewBox', `0 0 ${innerWidth} ${innerHeight}`);
      }

      function layoutHand() {
        // centro del riquadro video
        const vp = document.getElementById('viewport');
        const R = vp.getBoundingClientRect();

        const cx = R.left + R.width/2;
        const cy = R.top  + R.height/2;

        // lunghezza lancetta (resta costante, non si allunga)
        const len = Math.min(R.width, R.height) * 0.48;  // 48% del lato minore
        const tipW = Math.max(8, len * 0.04);            // base del triangolo

        // asta: dal centro verso destra (poi il gruppo ruota)
        shaft.setAttribute('x1', cx);
        shaft.setAttribute('y1', cy);
        shaft.setAttribute('x2', cx + len - tipW);
        shaft.setAttribute('y2', cy);

        // puntale triangolare
        const tx = cx + len;
        const ty = cy;
        tip.setAttribute('points', `${cx+len-tipW},${ty} ${tx},${ty-6} ${tx},${ty+6}`);

        // perno
        hub.setAttribute('cx', cx);
        hub.setAttribute('cy', cy);
      }

      // rotazione fluida del gruppo (non altera la lunghezza)
      let start = null;
      let cx = 0, cy = 0;
      function tick(ts){
        if(!start) start = ts;
        const t = (ts - start) / 1000;      // secondi
        const deg = (t * 20) % 360;         // 20Â°/s (regola la velocitÃ  se serve)
        
        // aggiorna centro per rotazione
        const vp = document.getElementById('viewport');
        const R = vp.getBoundingClientRect();
        cx = R.left + R.width/2;
        cy = R.top  + R.height/2;
        
        g.setAttribute('transform', `rotate(${deg} ${cx} ${cy})`);
        requestAnimationFrame(tick);
      }

      // importante: prima dimensiono SVG, poi layout, poi animazione
      function bootstrap(){
        placeSvg();
        layoutHand();
        requestAnimationFrame(tick);
      }

      // ricalcolo su resize/orientamento/pageshow
      addEventListener('resize', () => { placeSvg(); layoutHand(); });
      addEventListener('orientationchange', () => { setTimeout(() => { placeSvg(); layoutHand(); }, 200); });
      addEventListener('pageshow', () => { placeSvg(); layoutHand(); });

      // assicurati di eseguire dopo che #viewport Ã¨ in pagina
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', bootstrap);
      } else {
        bootstrap();
      }
    })();
  </script>

  <script>
    (function applyHoverPalette(){
      const root = getComputedStyle(document.documentElement);
      document.querySelectorAll('.node').forEach((el, i)=>{
        const v = root.getPropertyValue(`--hc${i}`).trim();
        el.style.setProperty('--hc', v || '#23b5a6'); // fallback teal
      });
    })();

    // Click sui pulsanti per aprire PDF nel viewport
    (function(){
      const viewport = document.getElementById('viewport');
      const originalVideo = viewport.innerHTML;
      
      document.querySelectorAll('.node').forEach((btn, i) => {
        btn.addEventListener('click', () => {
          const pdfPath = `../docs/pdf${i + 1}.pdf`;
          
          viewport.innerHTML = `
            <div style="width:100%; height:100%; display:flex; flex-direction:column; background:#0c1e25; border-radius:16px; overflow:hidden;">
              <div style="padding:12px; background:rgba(0,0,0,.3); display:flex; justify-content:space-between; align-items:center;">
                <span style="color:#e8fbff; font-weight:600;">PDF ${i + 1}</span>
                <button onclick="this.closest('#viewport').innerHTML = \`${originalVideo.replace(/`/g, '\\`')}\`" 
                        style="padding:6px 12px; background:#14b8a6; color:white; border:none; border-radius:8px; cursor:pointer; font-weight:600;">
                  Torna al video
                </button>
              </div>
              <iframe src="${pdfPath}" 
                      style="flex:1; border:none; background:white;"
                      title="PDF ${i + 1}">
                <p style="color:#e8fbff; padding:20px; text-align:center;">
                  Il PDF non puÃ² essere visualizzato. 
                  <a href="${pdfPath}" style="color:#14b8a6;">Apri in una nuova finestra</a>
                </p>
              </iframe>
            </div>
          `;
        });
      });
    })();
  </script>
</body>
</html>

