<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Mappa Ministeri – DMS</title>
<style>
  :root { --bg:#0f1418; --panel:#19222b; --ink:#cfe7ff; --chip:#253342; --chipOn:#2f94ff; }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:var(--bg);color:#eaf2fa;font:16px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Arial}
  header{position:sticky;top:0;z-index:10;background:linear-gradient(180deg,var(--bg),rgba(15,20,24,.8));padding:12px 12px 8px}
  .chips{display:flex;flex-wrap:wrap;gap:8px}
  .chip{border:1px solid #344455;background:var(--chip);color:#eaf2fa;border-radius:999px;padding:.45rem .8rem;cursor:pointer;user-select:none}
  .chip[aria-pressed="true"]{background:var(--chipOn);border-color:transparent}
  main{padding:0;max-width:1400px;margin:0 auto}
  .stage{background:var(--panel);border:1px solid #25313c; border-radius:10px; margin:10px 12px 24px; overflow:hidden}
  figure{margin:0}
  img.slide{display:block;width:100%;height:auto}
  .nav{display:flex;justify-content:space-between;gap:8px;padding:8px 10px;background:#0c1319;border-top:1px solid #1e2a35}
  .nav button{all:unset;background:#1f2d3a;padding:.45rem .8rem;border-radius:6px;cursor:pointer}
  .meta{opacity:.8;font-size:.9rem}
  .hint{opacity:.65;font-size:.85rem;margin-left:8px}
</style>
</head>
<body>
  <header>
    <div class="chips" id="chips"></div>
    <div class="hint">Suggerimento: usa ⬅︎ / ➜ per cambiare slide.</div>
  </header>
  <main>
    <section class="stage">
      <figure><img id="slide" class="slide" alt="Scheda ministeriale" src=""></figure>
      <div class="nav">
        <button id="prev" aria-label="precedente">◀︎</button>
        <div class="meta"><span id="label">—</span> · <span id="pos">0</span>/<span id="len">0</span></div>
        <button id="next" aria-label="successiva">▶︎</button>
      </div>
    </section>
  </main>

<script>
(async () => {
  // Base paths (relative, safe for Project Pages)
  const CARDS_DIR = "cards";
  const mapUrl = CARDS_DIR + "/_mapping.json";

  // Helpers
  const el = (q) => document.querySelector(q);
  const img = el("#slide");
  const chips = el("#chips");
  const label = el("#label");
  const pos = el("#pos");
  const len = el("#len");

  // State
  const M = await fetch(mapUrl).then(r => r.json()).catch(() => ({}));
  const keys = Object.keys(M);
  let current = keys[0] || "";
  let i = 0;

  // UI: build chips
  keys.forEach((k, idx) => {
    const b = document.createElement("button");
    b.className = "chip";
    b.textContent = k;
    b.setAttribute("aria-pressed", idx === 0 ? "true" : "false");
    b.addEventListener("click", () => select(k));
    chips.appendChild(b);
  });

  function select(k) {
    current = k;
    i = 0;
    chips.querySelectorAll(".chip").forEach(c => c.setAttribute("aria-pressed", c.textContent === k ? "true" : "false"));
    render();
  }

  function srcFor(k, idx) {
    const list = M[k] || [];
    const name = list[idx] || "generic.png";
    return CARDS_DIR + "/" + name;
  }

  function render() {
    const list = M[current] || [];
    len.textContent = list.length || 1;
    label.textContent = current || "—";
    pos.textContent = (i + 1);
    const src = srcFor(current, i);
    img.src = src;
    img.onerror = () => { img.src = CARDS_DIR + "/generic.png"; };
  }

  function next() {
    const L = (M[current] || []).length || 1;
    i = (i + 1) % L;
    render();
  }
  function prev() {
    const L = (M[current] || []).length || 1;
    i = (i - 1 + L) % L;
    render();
  }

  el("#next").addEventListener("click", next);
  el("#prev").addEventListener("click", prev);
  window.addEventListener("keydown", (e) => {
    if (e.key === "ArrowRight") next();
    if (e.key === "ArrowLeft") prev();
  });

  // Boot
  render();
})();
</script>
</body>
</html>
