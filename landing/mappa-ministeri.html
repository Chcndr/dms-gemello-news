<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Mappa Ministeri — DMS</title>
<style>
  :root{--bg:#0e141b;--fg:#e8f0f7;--chip:#1b2a38;--chipfg:#b7c7d6}
  html,body{margin:0;background:var(--bg);color:var(--fg);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu}
  .wrap{max-width:1200px;margin:20px auto;padding:0 16px}
  .chips{display:flex;flex-wrap:wrap;gap:8px;margin:8px 0 16px}
  .chip{background:var(--chip);color:var(--chipfg);padding:8px 12px;border-radius:999px;cursor:pointer;font-size:14px;user-select:none}
  .chip.active{outline:2px solid #4db3ff;color:#fff}
  .stage{background:#081018;border-radius:12px;padding:8px;min-height:60vh;display:flex;align-items:center;justify-content:center;position:relative}
  img.slide{width:100%;height:auto;border-radius:10px;display:block}
  .nav{position:absolute;right:8px;bottom:8px;display:flex;gap:6px}
  .nav button{background:#12202d;color:#cfe7ff;border:0;border-radius:6px;padding:8px 10px;cursor:pointer}
  .empty{width:100%}
  .hint{position:absolute;left:12px;top:12px;font-size:12px;color:#9bb3c9}
</style>
</head>
<body>
<div class="wrap">
  <div class="chips" id="chips"></div>
  <div class="stage">
    <div class="hint" id="hint">Seleziona un ministero…</div>
    <img class="slide" id="slide" src="" alt="" style="display:none">
    <img class="slide empty" id="empty" src="landing/cards/generic.png" alt="">
    <div class="nav">
      <button id="prev" aria-label="Precedente">◀︎</button>
      <button id="next" aria-label="Successiva">▶︎</button>
    </div>
  </div>
</div>
<script>
const MINISTERI = [
  ["mef","MEF • Economia e Finanze"],
  ["interno","Ministero dell’Interno"],
  ["mimit","MIMIT • Imprese e Made in Italy"],
  ["mase","MASE • Ambiente e Sicurezza Energetica"],
  ["mit","MIT • Infrastrutture e Trasporti"],
  ["salute","Salute"],
  ["mic","MiC • Cultura"],
  ["turismo","Turismo"],
  ["masaf","MASAF • Agricoltura"],
  ["mim","MIM • Istruzione e Merito"],
  ["lavoro","Ministero del Lavoro"],
  ["maeci","MAECI • Esteri e Cooperazione"],
  ["agid","AgID"],
  ["pagopa","PagoPA S.p.A."],
  ["ae","AE • Agenzia Entrate"],
  ["adm","ADM • Agenzia Dogane e Monopoli"]
];
let mapping = {}, curKey=null, curIdx=0;
const chipsEl = document.getElementById('chips');
const slideEl = document.getElementById('slide');
const emptyEl = document.getElementById('empty');
const hintEl = document.getElementById('hint');

fetch('landing/cards/_mapping.json?_=' + Date.now())
  .then(r=>r.json()).then(m=>{ mapping=m; init(); })
  .catch(()=>{ mapping={}; init(); });

function init(){
  chipsEl.innerHTML = '';
  MINISTERI.forEach(([key,label])=>{
    const b=document.createElement('button');
    b.textContent=label;
    b.className='chip';
    b.onclick=()=>select(key);
    b.dataset.key=key;
    chipsEl.appendChild(b);
  });
  select('mef');
}
function select(key){
  curKey=key; curIdx=0;
  document.querySelectorAll('.chip').forEach(c=>c.classList.toggle('active', c.dataset.key===key));
  render();
}
function filesForKey(key){
  return (mapping[key]||[]).map(f=>'landing/cards/'+f);
}
function render(){
  const arr = filesForKey(curKey);
  if(arr.length===0){
    slideEl.style.display='none';
    emptyEl.style.display='block';
    hintEl.textContent = "Nessuna immagine per '"+curKey+"'. Aggiungi file in /landing/cards e aggiorna _mapping.json";
  }else{
    slideEl.src = arr[curIdx % arr.length] + '?_=' + Date.now();
    slideEl.style.display='block';
    emptyEl.style.display='none';
    hintEl.textContent = (arr.length>1? (curIdx+1)+'/'+arr.length+' — ' : '') + curKey;
  }
}
document.getElementById('prev').onclick=()=>{ if(!curKey)return; curIdx = (curIdx-1+999)%999; render(); };
document.getElementById('next').onclick=()=>{ if(!curKey)return; curIdx = (curIdx+1)%999; render(); };
</script>
</body>
</html>
