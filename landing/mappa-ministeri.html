<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DMS · Gemello Digitale — Mappa Ministeri</title>
  <style>
:root{ --green:#0F7A4C; --bg:#0b1418; --card:#0f2026; --ink:#dff7ff; font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif }
body{ margin:0; background:#071319; color:var(--ink) }
.topnav{ display:flex; gap:.75rem; padding:.6rem 1rem; background:#081319; position:sticky; top:0; z-index:5 }
.topnav a{ color:#cfefff; text-decoration:none; padding:.35rem .7rem; border-radius:8px; background:#0e2230 }
#mapWrap{ padding:1.25rem; display:grid; place-items:center }

/* Contenitore fisso stile sito, niente pinch-zoom che sposta tutto */
#mapStage{
  width: min(1140px, 92vw);
  height: min(720px, calc(92vw * 0.63));
  margin: 32px auto 64px;
  position: relative;
  background: radial-gradient(120% 120% at 50% 40%, #0d2026 0%, #08171c 55%, #081318 100%);
  border-radius: 16px;
  box-shadow: 0 8px 32px rgba(0,0,0,.45), inset 0 0 0 1px rgba(255,255,255,.06);
  overflow: hidden;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  user-select: none;
  touch-action: manipulation;
}

/* Ring che ruota */
.ring{
  position: absolute; inset: 0;
  transform-origin: 50% 55%;
}
@keyframes spin { from{transform: rotate(0)} to{transform: rotate(360deg)} }
.ring.auto-rotate{ animation: spin 56s linear infinite; }

/* Nodi – rettangolari grandi con retro-illuminazione */
.node-btn{
  position: absolute; 
  width: 164px; height: 104px;
  border: 0; border-radius: 18px;
  background: rgba(18,38,46,.82);
  color: #d7eef5; font-weight: 700; line-height: 1.2;
  box-shadow:
    inset 0 0 0 2px rgba(255,255,255,.08),
    0 8px 18px rgba(0,200,255,.12),
    0 0 24px rgba(0,200,255,.15);
  text-shadow: 0 0 8px rgba(0,200,255,.35);
  backdrop-filter: blur(2px);
  display: grid; place-items: center; padding: 10px;
  cursor: pointer;
  outline: none;
  transform: translate(-50%, -50%) rotate(calc(-1 * var(--deg)));
  transition: transform .18s ease, box-shadow .18s ease, background .18s ease, opacity .18s ease;
}
.node-btn:hover, .node-btn:focus-visible{
  background: rgba(20,48,56,.92);
  box-shadow:
    inset 0 0 0 2px #3ad6ff,
    0 14px 26px rgba(0,210,255,.28),
    0 0 42px rgba(0,210,255,.35);
  transform: translate(-50%, -50%) rotate(calc(-1 * var(--deg))) scale(1.045);
}

/* Ricerca: match evidenziato, altri attenuati */
.node-btn.dimmed { opacity:.22; filter:saturate(.5) blur(.1px); }
.node-btn.highlight { opacity:1; filter:none; }

/* Logo centrale con glow */
#logo{
  position:absolute; left:50%; top:55%;
  transform: translate(-50%,-50%);
  filter: drop-shadow(0 0 28px rgba(0,178,255,.42)) drop-shadow(0 0 68px rgba(0,178,255,.22));
}
#logo img{ width: 120px; height:auto; display:block; }

/* MODAL */
#modalRoot{ position:fixed; inset:0; display:none; pointer-events:none; z-index:1100 }
#modalRoot.is-open{ display:block; pointer-events:auto }
#modalRoot .overlay{ position:absolute; inset:0; background:rgba(0,0,0,.6) }
.modalCard{ position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);
  width: min(92vw, 1140px); background:var(--card); border-radius:14px; overflow:hidden; }
#modalHeader{ background:#0F7A4C !important; color:#fff; display:flex; gap:.75rem; align-items:center; padding:.7rem 1rem }
#modalHeader h3{ margin:0; font-weight:700; flex:1 }
#modalHeader .back{ background:#0b5f3a; color:#fff; border:0; border-radius:8px; padding:.35rem .6rem; cursor:pointer }
#spotBtns a{ background:#0e2230; color:#fff; text-decoration:none; border-radius:8px; padding:.35rem .6rem; margin-left:.4rem }
#modalBody{ padding:1rem; background:#0b161b }
.doc{ margin:0 0 1rem 0; }
.doc img{ width:100%; height:auto; display:block; border-radius:10px }
#modalRoot:not(.is-open) *{ pointer-events:none }
</style>
</head>
<body>
  <nav class="topnav">
    <div class="nav-left">
      <a href="/dms-gemello-news/landing/home.html">Home</a>
      <a href="/dms-gemello-news/landing/mappa-ministeri.html">Mappa</a>
      <a href="/dms-gemello-news/landing/spot.html">Spot</a>
    </div>
    <div class="nav-center">
      <label class="checkbox-control">
        <input type="checkbox" id="autoRotate" checked>
        <span>Auto-rotate</span>
      </label>
      <label class="checkbox-control">
        <input type="checkbox" id="showLines" checked>
        <span>Linee</span>
      </label>
      <input type="text" id="searchMinistero" placeholder="Cerca ministero..." class="search-input">
    </div>
    <div class="nav-right">
      <span class="page-title">Mappa Ministeri (sandbox)</span>
    </div>
  </nav>

  <main id="mapWrap" aria-label="Mappa Ministeri (sandbox)">
    <div id="mapStage">
<div id="ring" class="ring auto-rotate" aria-live="polite">
  <button class="node-btn" data-slug="agid"><span>AgID</span></button>
  <button class="node-btn" data-slug="mef"><span>MEF · Economia e Finanze</span></button>
  <button class="node-btn" data-slug="interno"><span>Ministero dell'Interno</span></button>
  <button class="node-btn" data-slug="mimit"><span>MIMIT · Imprese e Made in Italy</span></button>
  <button class="node-btn" data-slug="mase"><span>MASE · Ambiente e Sicurezza</span></button>
  <button class="node-btn" data-slug="mit"><span>MIT · Infrastrutture e Trasporti</span></button>
  <button class="node-btn" data-slug="salute"><span>Ministero della Salute</span></button>
  <button class="node-btn" data-slug="mic"><span>MIC · Cultura</span></button>
  <button class="node-btn" data-slug="turismo"><span>Ministero del Turismo</span></button>
  <button class="node-btn" data-slug="masaf"><span>MASAF · Agricoltura</span></button>
  <button class="node-btn" data-slug="mim"><span>MIM · Istruzione e Merito</span></button>
  <button class="node-btn" data-slug="lavoro"><span>Ministero del Lavoro</span></button>
  <button class="node-btn" data-slug="maeci"><span>MAECI · Affari Esteri</span></button>
  <button class="node-btn" data-slug="pagopa"><span>PagoPA S.p.A.</span></button>
  <button class="node-btn" data-slug="ae"><span>AE · Agenzia Entrate</span></button>
  <button class="node-btn" data-slug="adm"><span>ADM · Agenzia Dogane</span></button>
</div>

<div id="logo" aria-hidden="true">
  <img src="../img/logo-istituzione.svg" alt="" />
</div>
    </div>
  </main>

  <!-- MODAL -->
  <div id="modalRoot" aria-hidden="true">
    <div class="overlay" role="presentation"></div>
    <div class="modalCard" role="dialog" aria-modal="true">
      <header id="modalHeader">
        <button id="btnBack" class="back">← Torna alla mappa</button>
        <h3 id="modalTitle"></h3>
        <div id="spotBtns"></div>
      </header>
      <section id="modalBody" aria-live="polite"></section>
    </div>
  </div>

<script>
/* Dati semplici (più item = più schede impilate) */
window.DOC_MAP = {
  agid   : { title:"AgID",                            cards:[{img:"/dms-gemello-news/assets/doc/agid.jpg",    alt:"AgID"}] },
  mef    : { title:"MEF - Economia e Finanze",        cards:[{img:"/dms-gemello-news/assets/doc/mef.jpg",     alt:"MEF"}] },
  interno: { title:"Ministero dell'Interno",          cards:[{img:"/dms-gemello-news/assets/doc/interno.jpg", alt:"Interno"}] },
  salute : { title:"Ministero della Salute",          cards:[{img:"/dms-gemello-news/assets/doc/salute.jpg",  alt:"Salute"}] },
  turismo: { title:"Ministero del Turismo",           cards:[{img:"/dms-gemello-news/assets/doc/turismo.jpg", alt:"Turismo"}] },
  lavoro : { title:"Ministero del Lavoro",            cards:[{img:"/dms-gemello-news/assets/doc/lavoro.jpg",  alt:"Lavoro"}] },
  mit    : { title:"MIT - Infrastrutture e Trasporti",cards:[{img:"/dms-gemello-news/assets/doc/mit.jpg",     alt:"MIT"}] },
  mim    : { title:"MIM - Istruzione e Merito",       cards:[{img:"/dms-gemello-news/assets/doc/mim.jpg",     alt:"MIM"}] },
  mimit  : { title:"MIMIT - Imprese e Made in Italy", cards:[{img:"/dms-gemello-news/assets/doc/mimit.jpg",   alt:"MIMIT"}] },
  mase   : { title:"MASE - Ambiente e Sicurezza",     cards:[{img:"/dms-gemello-news/assets/doc/mase.jpg",    alt:"MASE"}] },
  masaf  : { title:"MASAF - Agricoltura",             cards:[{img:"/dms-gemello-news/assets/doc/masaf.jpg",   alt:"MASAF"}] },
  maeci  : { title:"MAECI - Affari Esteri",           cards:[{img:"/dms-gemello-news/assets/doc/maeci.jpg",   alt:"MAECI"}] },
  mic    : { title:"MIC - Cultura",                   cards:[{img:"/dms-gemello-news/assets/doc/mic.jpg",     alt:"MIC"}] },
  ae     : { title:"Agenzia Entrate",                 cards:[{img:"/dms-gemello-news/assets/doc/ae.jpg",      alt:"AE"}] },
  adm    : { title:"Agenzia Dogane",                  cards:[{img:"/dms-gemello-news/assets/doc/adm.jpg",     alt:"ADM"}] },
  pagopa : { title:"PagoPA S.p.A.",                   cards:[{img:"/dms-gemello-news/assets/doc/pagopa.jpg",  alt:"PagoPA"}] }
};

const $ = s => document.querySelector(s);
const root = $('#modalRoot'), title = $('#modalTitle'), body = $('#modalBody'), spot = $('#spotBtns');

function renderSpotButtons(slug){
  const href = `/dms-gemello-news/landing/spot.html#${slug}`;
  spot.innerHTML = `<a href="${href}">Apri in SPOT</a>`;
}
function renderDocs(cards){
  body.innerHTML = cards.map(c=>`<figure class="doc"><img src="${c.img}" alt="${c.alt||''}"></figure>`).join('');
}
function openFull(slug){
  const d = window.DOC_MAP[slug]; if(!d) return;
  title.textContent = d.title;
  renderSpotButtons(slug);
  renderDocs(d.cards||[]);
  root.classList.add('is-open');
  root.setAttribute('aria-hidden','false');
  if(location.hash.slice(1)!==slug) location.hash = slug;
}
function closeModal(updateHash=true){
  root.classList.remove('is-open');
  root.setAttribute('aria-hidden','true');
  if(updateHash) history.replaceState(null,'', location.pathname);
}

// === Posizionamento corona e interazioni ===
(() => {
  const ring = document.querySelector('#ring');
  const nodes = [...ring.querySelectorAll('.node-btn')];

  // Disposizione in corona e contatore rotazione testo
  function layout(){
    const stage = document.querySelector('#mapStage');
    const w = stage.clientWidth, h = stage.clientHeight;
    const cx = w/2, cy = h*0.55;                  // centro visivo leggermente più in alto
    const R = Math.min(w,h) * 0.36;               // raggio responsive
    nodes.forEach((el,i) => {
      const theta = (i / nodes.length) * Math.PI*2;
      const x = cx + R * Math.cos(theta);
      const y = cy + R * Math.sin(theta);
      el.style.left = x + 'px';
      el.style.top  = y + 'px';
      el.style.setProperty('--deg', (theta * 180/Math.PI) + 'deg');
    });
  }
  layout(); 
  addEventListener('resize', layout);

  // Click -> openFull con slug
  nodes.forEach(btn => {
    btn.addEventListener('click', () => {
      const slug = btn.dataset.slug;
      if (window.openFull) window.openFull(slug);
      else location.hash = slug; // fallback
    });
  });

  // iPad: niente selezione/long-press preview
  document.addEventListener('touchstart', () => {}, {passive:true});
})();

// Inizializzazione al caricamento
document.addEventListener('DOMContentLoaded',()=>{
  closeModal(false);
  $('#btnBack').addEventListener('click',()=>closeModal());
  document.addEventListener('keydown',e=>{ if(e.key==='Escape') closeModal(); });
  const s = location.hash.slice(1); if(window.DOC_MAP[s]) openFull(s);
});

window.addEventListener('hashchange',()=>{
  const s = location.hash.slice(1);
  if(window.DOC_MAP[s]) openFull(s); else closeModal(false);
});
</script>
</body>
</html>

