<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DMS · Gemello Digitale — Mappa Ministeri</title>
  <style>
:root{ --green:#0F7A4C; --bg:#0b1418; --card:#0f2026; --ink:#dff7ff; font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif }
body{ margin:0; background:#071319; color:var(--ink) }
.topnav{ display:flex; gap:.75rem; padding:.6rem 1rem; background:#081319; position:sticky; top:0; z-index:5 }
.topnav a{ color:#cfefff; text-decoration:none; padding:.35rem .7rem; border-radius:8px; background:#0e2230 }
#mapWrap{ padding:1.25rem; display:grid; place-items:center }
#ring{ position:relative; width:min(86vw,920px); aspect-ratio:1; border-radius:999px; }
.node{
  position:absolute; inset:auto;
  background:rgba(28,61,72,.9); color:#fff; border:0; border-radius:14px; padding:.5rem .8rem;
  cursor:pointer; user-select:none; -webkit-user-select:none; touch-action:manipulation;
  box-shadow:0 8px 24px rgba(0,0,0,.25);
}
/* posizionamento rapido dei 16 nodi (corona) */
#ring .node:nth-child(1){  --a:0   } #ring .node:nth-child(2){  --a:22.5 } #ring .node:nth-child(3){  --a:45  }
#ring .node:nth-child(4){  --a:67.5} #ring .node:nth-child(5){  --a:90  } #ring .node:nth-child(6){  --a:112.5}
#ring .node:nth-child(7){  --a:135 } #ring .node:nth-child(8){  --a:157.5} #ring .node:nth-child(9){  --a:180 }
#ring .node:nth-child(10){ --a:202.5}#ring .node:nth-child(11){ --a:225 } #ring .node:nth-child(12){ --a:247.5}
#ring .node:nth-child(13){ --a:270 } #ring .node:nth-child(14){ --a:292.5} #ring .node:nth-child(15){ --a:315 }
#ring .node:nth-child(16){ --a:337.5}
#ring .node{
  --r: calc(50% - 110px);
  left: calc(50% + var(--r) * cos(var(--a)*1deg));
  top:  calc(50% + var(--r) * sin(var(--a)*1deg));
  transform: translate(-50%,-50%);
}

/* MODAL */
#modalRoot{ position:fixed; inset:0; display:none; pointer-events:none; z-index:1100 }
#modalRoot.is-open{ display:block; pointer-events:auto }
#modalRoot .overlay{ position:absolute; inset:0; background:rgba(0,0,0,.6) }
.modalCard{ position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);
  width: min(92vw, 1140px); background:var(--card); border-radius:14px; overflow:hidden; }
#modalHeader{ background:var(--green); color:#fff; display:flex; gap:.75rem; align-items:center; padding:.7rem 1rem }
#modalHeader h3{ margin:0; font-weight:700; flex:1 }
#modalHeader .back{ background:#0b5f3a; color:#fff; border:0; border-radius:8px; padding:.35rem .6rem; cursor:pointer }
#spotBtns a{ background:#0e2230; color:#fff; text-decoration:none; border-radius:8px; padding:.35rem .6rem; margin-left:.4rem }
#modalBody{ padding:1rem; background:#0b161b }
.doc{ margin:0 0 1rem 0; }
.doc img{ width:100%; height:auto; display:block; border-radius:10px }
#modalRoot:not(.is-open) *{ pointer-events:none }
}

/* === Glow & Focus v1 === */
:root{
  --accent: #0F7A4C; /* verde sito */
  --accent-24: rgba(15,122,76,.24);
  --accent-45: rgba(15,122,76,.45);
  --ink: #e7fbf5;
}

/* retro-illuminazione HUB (logo al centro, glow BLU come versione buona) */
#hubIcon{
  position:absolute; left:50%; top:50%; width:160px; height:160px;
  transform:translate(-50%,-50%); pointer-events:none;
  filter: drop-shadow(0 0 24px rgba(56,189,248,.45));
}
#hubIcon::before{
  content:""; position:absolute; inset:0;
  background:
    radial-gradient(60% 60% at 50% 50%, rgba(56,189,248,.22), transparent 65%),
    url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" fill="%23e6f7ff" stroke="%2300b3ff" stroke-width="14"><path d="M20 230h600L320 80 20 230zM80 260h80v260H80V260zm120 0h120v260H200V260zm160 0h120v260H360V260zm160 0h80v260h-80V260zM40 540h560v30H40z"/></svg>')
    center/72% no-repeat;
  opacity:.95;
}
#hubIcon::after{
  content:""; position:absolute; inset:-28%;
  border-radius:40%;
  background: radial-gradient(60% 70% at 50% 40%, rgba(30,144,255,.25) 0%, transparent 70%);
  filter: blur(14px);
}

/* nodi/tile: retro-illuminazione + stati hover/focus/ricerca */
.node{
  /* NON toccare il transform inline impostato dal layout JS */
  transition: box-shadow .22s ease, filter .18s ease, opacity .18s ease;
  box-shadow:
    0 6px 18px rgba(0,0,0,.25),
    0 0 0 1px rgba(255,255,255,.06) inset;
  filter: drop-shadow(0 4px 10px rgba(0,0,0,.18));
  will-change: filter, box-shadow, opacity;
}
.node:hover,
.node:focus-visible{
  box-shadow:
    0 8px 26px rgba(0,0,0,.36),
    0 0 0 1px rgba(255,255,255,.10) inset,
    0 0 22px var(--accent-45);
  filter: brightness(1.06);
  outline: 2px solid var(--accent-24);
  outline-offset: -2px;
}
.node:active{ filter: brightness(.96); }

/* evidenziazione da ricerca */
.node.is-hit{
  box-shadow:
    0 10px 30px rgba(0,0,0,.38),
    0 0 0 1px rgba(255,255,255,.12) inset,
    0 0 26px var(--accent-45);
  filter: brightness(1.10);
}
.node.dim{ opacity:.20; filter: grayscale(.15) brightness(.92); }

/* chip di navigazione (se presenti) */
.chip.nav{
  transition: box-shadow .18s ease, filter .18s ease;
}
.chip.nav:hover,
.chip.nav:focus-visible{
  box-shadow: 0 0 18px var(--accent-24);
  filter: brightness(1.06);
}

/* opzionale: riduzione movimento */
@media (prefers-reduced-motion: reduce){
  .node, .chip.nav{ transition:none }
}

/* linee ON/OFF già gestite, lasciamo transizione dolce */
:root[data-lines='off'] #links{ opacity:0; transition:.24s }
:root[data-lines='on']  #links{ opacity:1; transition:.24s }
</style>
</head>
<body>
  <nav class="topnav">
    <a href="/dms-gemello-news/landing/home.html">Home</a>
    <a href="/dms-gemello-news/landing/mappa-ministeri.html">Mappa</a>
    <a href="/dms-gemello-news/landing/spot.html">Spot</a>
  </nav>

  <main id="mapWrap" aria-label="Mappa Ministeri (sandbox)">
    <div id="ring">
      <!-- 16 nodi: usare button/div (NO <a>) per evitare anteprime su iPad -->
      <button class="node" data-slug="agid"    aria-label="AgID">AgID</button>
      <button class="node" data-slug="mef"     aria-label="MEF">MEF</button>
      <button class="node" data-slug="interno" aria-label="Ministero dell'Interno">Interno</button>
      <button class="node" data-slug="salute"  aria-label="Ministero della Salute">Salute</button>
      <button class="node" data-slug="turismo" aria-label="Ministero del Turismo">Turismo</button>
      <button class="node" data-slug="lavoro"  aria-label="Ministero del Lavoro">Lavoro</button>
      <button class="node" data-slug="mit"     aria-label="MIT - Infrastrutture e Trasporti">MIT</button>
      <button class="node" data-slug="mim"     aria-label="MIM - Istruzione e Merito">MIM</button>
      <button class="node" data-slug="mimit"   aria-label="MIMIT - Imprese e Made in Italy">MIMIT</button>
      <button class="node" data-slug="mase"    aria-label="MASE - Ambiente e Sicurezza Energetica">MASE</button>
      <button class="node" data-slug="masaf"   aria-label="MASAF - Agricoltura">MASAF</button>
      <button class="node" data-slug="maeci"   aria-label="MAECI - Affari Esteri">MAECI</button>
      <button class="node" data-slug="mic"     aria-label="MIC - Cultura">MIC</button>
      <button class="node" data-slug="ae"      aria-label="Agenzia Entrate">AE</button>
      <button class="node" data-slug="adm"     aria-label="Agenzia Dogane">ADM</button>
      <button class="node" data-slug="pagopa"  aria-label="PagoPA S.p.A.">PagoPA</button>
    </div>
  </main>

  <!-- MODAL -->
  <div id="modalRoot" aria-hidden="true">
    <div class="overlay" role="presentation"></div>
    <div class="modalCard" role="dialog" aria-modal="true">
      <header id="modalHeader">
        <button id="btnBack" class="back">← Torna alla mappa</button>
        <h3 id="modalTitle"></h3>
        <div id="spotBtns"></div>
      </header>
      <section id="modalBody" aria-live="polite"></section>
    </div>
  </div>

<script>
/* Dati semplici (più item = più schede impilate) */
window.DOC_MAP = {
  agid   : { title:"AgID",                            cards:[{img:"/dms-gemello-news/assets/doc/agid.jpg",    alt:"AgID"}] },
  mef    : { title:"MEF - Economia e Finanze",        cards:[{img:"/dms-gemello-news/assets/doc/mef.jpg",     alt:"MEF"}] },
  interno: { title:"Ministero dell'Interno",          cards:[{img:"/dms-gemello-news/assets/doc/interno.jpg", alt:"Interno"}] },
  salute : { title:"Ministero della Salute",          cards:[{img:"/dms-gemello-news/assets/doc/salute.jpg",  alt:"Salute"}] },
  turismo: { title:"Ministero del Turismo",           cards:[{img:"/dms-gemello-news/assets/doc/turismo.jpg", alt:"Turismo"}] },
  lavoro : { title:"Ministero del Lavoro",            cards:[{img:"/dms-gemello-news/assets/doc/lavoro.jpg",  alt:"Lavoro"}] },
  mit    : { title:"MIT - Infrastrutture e Trasporti",cards:[{img:"/dms-gemello-news/assets/doc/mit.jpg",     alt:"MIT"}] },
  mim    : { title:"MIM - Istruzione e Merito",       cards:[{img:"/dms-gemello-news/assets/doc/mim.jpg",     alt:"MIM"}] },
  mimit  : { title:"MIMIT - Imprese e Made in Italy", cards:[{img:"/dms-gemello-news/assets/doc/mimit.jpg",   alt:"MIMIT"}] },
  mase   : { title:"MASE - Ambiente e Sicurezza",     cards:[{img:"/dms-gemello-news/assets/doc/mase.jpg",    alt:"MASE"}] },
  masaf  : { title:"MASAF - Agricoltura",             cards:[{img:"/dms-gemello-news/assets/doc/masaf.jpg",   alt:"MASAF"}] },
  maeci  : { title:"MAECI - Affari Esteri",           cards:[{img:"/dms-gemello-news/assets/doc/maeci.jpg",   alt:"MAECI"}] },
  mic    : { title:"MIC - Cultura",                   cards:[{img:"/dms-gemello-news/assets/doc/mic.jpg",     alt:"MIC"}] },
  ae     : { title:"Agenzia Entrate",                 cards:[{img:"/dms-gemello-news/assets/doc/ae.jpg",      alt:"AE"}] },
  adm    : { title:"Agenzia Dogane",                  cards:[{img:"/dms-gemello-news/assets/doc/adm.jpg",     alt:"ADM"}] },
  pagopa : { title:"PagoPA S.p.A.",                   cards:[{img:"/dms-gemello-news/assets/doc/pagopa.jpg",  alt:"PagoPA"}] }
};

const $ = s => document.querySelector(s);
const root = $('#modalRoot'), title = $('#modalTitle'), body = $('#modalBody'), spot = $('#spotBtns');

function renderSpotButtons(slug){
  const href = `/dms-gemello-news/landing/spot.html#${slug}`;
  spot.innerHTML = `<a href="${href}">Apri in SPOT</a>`;
}
function renderDocs(cards){
  body.innerHTML = cards.map(c=>`<figure class="doc"><img src="${c.img}" alt="${c.alt||''}"></figure>`).join('');
}
function openFull(slug){
  const d = window.DOC_MAP[slug]; if(!d) return;
  title.textContent = d.title;
  renderSpotButtons(slug);
  renderDocs(d.cards||[]);
  root.classList.add('is-open');
  root.setAttribute('aria-hidden','false');
  if(location.hash.slice(1)!==slug) location.hash = slug;
}
function closeModal(updateHash=true){
  root.classList.remove('is-open');
  root.setAttribute('aria-hidden','true');
  if(updateHash) history.replaceState(null,'', location.pathname);
}
function bindNodes(){
  document.querySelectorAll('.node[data-slug]').forEach(n=>{
    const slug = n.dataset.slug;
    n.addEventListener('click',()=>openFull(slug));
    n.addEventListener('keydown',e=>{
      if(e.key==='Enter'||e.key===' '){ e.preventDefault(); openFull(slug); }
    });
  });
}
document.addEventListener('DOMContentLoaded',()=>{
  closeModal(false);
  bindNodes();
  $('#btnBack').addEventListener('click',()=>closeModal());
  document.addEventListener('keydown',e=>{ if(e.key==='Escape') closeModal(); });
  const s = location.hash.slice(1); if(window.DOC_MAP[s]) openFull(s);
});
window.addEventListener('hashchange',()=>{
  const s = location.hash.slice(1);
  if(window.DOC_MAP[s]) openFull(s); else closeModal(false);
});

/* === Glow & Search states v1 (non invasivo) === */
(function(){
  // accessori
  const $ = (s, r=document)=> r.querySelector(s);
  const $$= (s, r=document)=> Array.from(r.querySelectorAll(s));

  // 1) accessibilità tastiera sui nodi (senza toccare layout/onclick esistenti)
  function armNodes(){
    $$('.node').forEach(n=>{
      if(n.classList.contains('center')) return;
      if(!n.hasAttribute('tabindex')) n.tabIndex = 0;
      n.addEventListener('keydown', e=>{
        if(e.key==='Enter' || e.key===' '){ e.preventDefault(); n.click(); }
      }, {passive:false});
    });
  }

  // 2) evidenziazione "soft search": aggiunge classi senza alterare altro codice
  const q = $('#q');
  function applySearchHighlight(val){
    const v = (val||'').trim().toLowerCase();
    const nodes = $$('.node').filter(n=>!n.classList.contains('center'));
    if(!v){
      nodes.forEach(n=>{ n.classList.remove('is-hit','dim'); });
      return;
    }
    nodes.forEach(n=>{
      const label = n.querySelector('.label')?.textContent?.toLowerCase() || '';
      const hit = label.includes(v);
      n.classList.toggle('is-hit', hit);
      n.classList.toggle('dim', !hit);
    });
  }
  q && q.addEventListener('input', ()=>applySearchHighlight(q.value));

  // bootstrap (anche dopo redraw)
  document.addEventListener('DOMContentLoaded', armNodes);
  // nel caso il layout ridisegni i nodi:
  const world = document.getElementById('world');
  if(world){
    new MutationObserver(()=>armNodes()).observe(world,{childList:true,subtree:true});
  }
})();
</script>
</body>
</html>

