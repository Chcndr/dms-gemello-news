<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DMS · Gemello Digitale — Mappa Ministeri</title>
  <style>
:root{ --green:#0F7A4C; --bg:#0b1418; --card:#0f2026; --ink:#dff7ff; font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif }
body{ margin:0; background:#071319; color:var(--ink) }
.topnav{ display:flex; gap:.75rem; padding:.6rem 1rem; background:#081319; position:sticky; top:0; z-index:5 }
.topnav a{ color:#cfefff; text-decoration:none; padding:.35rem .7rem; border-radius:8px; background:#0e2230 }
#mapWrap{ padding:1.25rem; display:grid; place-items:center }

/* Contenitore fisso stile sito, niente pinch-zoom che sposta tutto */
#mapStage{
  width: min(1140px, 92vw);
  height: min(720px, calc(92vw * 0.63));
  margin: 32px auto 64px;
  position: relative;
  background: radial-gradient(120% 120% at 50% 40%, #0d2026 0%, #08171c 55%, #081318 100%);
  border-radius: 16px;
  box-shadow: 0 8px 32px rgba(0,0,0,.45), inset 0 0 0 1px rgba(255,255,255,.06);
  overflow: hidden;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  user-select: none;
  touch-action: manipulation;
}

/* Ring che ruota */
.ring{
  position: absolute; inset: 0;
  transform-origin: 50% 55%;
}
@keyframes spin { from{transform: rotate(0)} to{transform: rotate(360deg)} }
.ring.auto-rotate{ animation: spin 56s linear infinite; }

/* Nodi – rettangolari grandi con retro-illuminazione */
.node-btn{
  position: absolute; 
  width: 164px; height: 104px;
  border: 0; border-radius: 18px;
  background: rgba(18,38,46,.82);
  color: #d7eef5; font-weight: 700; line-height: 1.2;
  box-shadow:
    inset 0 0 0 2px rgba(255,255,255,.08),
    0 8px 18px rgba(0,200,255,.12),
    0 0 24px rgba(0,200,255,.15);
  text-shadow: 0 0 8px rgba(0,200,255,.35);
  backdrop-filter: blur(2px);
  display: grid; place-items: center; padding: 10px;
  cursor: pointer;
  outline: none;
  transform: translate(-50%, -50%) rotate(calc(-1 * var(--deg)));
  transition: transform .18s ease, box-shadow .18s ease, background .18s ease, opacity .18s ease;
}
.node-btn:hover, .node-btn:focus-visible{
  background: rgba(20,48,56,.92);
  box-shadow:
    inset 0 0 0 2px #3ad6ff,
    0 14px 26px rgba(0,210,255,.28),
    0 0 42px rgba(0,210,255,.35);
  transform: translate(-50%, -50%) rotate(calc(-1 * var(--deg))) scale(1.045);
}

/* Ricerca: match evidenziato, altri attenuati */
.node-btn.dimmed { opacity:.22; filter:saturate(.5) blur(.1px); }
.node-btn.highlight { opacity:1; filter:none; }

/* Logo centrale con glow */
#logo{
  position:absolute; left:50%; top:55%;
  transform: translate(-50%,-50%);
  filter: drop-shadow(0 0 28px rgba(0,178,255,.42)) drop-shadow(0 0 68px rgba(0,178,255,.22));
}
#logo img{ width: 120px; height:auto; display:block; }

/* MODAL */
#modalRoot{ position:fixed; inset:0; display:none; pointer-events:none; z-index:1100 }
#modalRoot.is-open{ display:block; pointer-events:auto }
#modalRoot .overlay{ position:absolute; inset:0; background:rgba(0,0,0,.6) }
.modalCard{ position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);
  width: min(92vw, 1140px); background:var(--card); border-radius:14px; overflow:hidden; }
#modalHeader{ background:#0F7A4C !important; color:#fff; display:flex; gap:.75rem; align-items:center; padding:.7rem 1rem }
#modalHeader h3{ margin:0; font-weight:700; flex:1 }
#modalHeader .back{ background:#0b5f3a; color:#fff; border:0; border-radius:8px; padding:.35rem .6rem; cursor:pointer }
#spotBtns a{ background:#0e2230; color:#fff; text-decoration:none; border-radius:8px; padding:.35rem .6rem; margin-left:.4rem }
#modalBody{ padding:1rem; background:#0b161b }
.doc{ margin:0 0 1rem 0; }
.doc img{ width:100%; height:auto; display:block; border-radius:10px }
#modalRoot:not(.is-open) *{ pointer-events:none }

/* === MAPPA: container fisso, glow, tasti orizzontali === */
:root{
  --site:#0f1920;            /* sfondo pagina */
  --box:#0b1e26;             /* container mappa (scuro) */
  --glow:#00d0ff;            /* alone ciano */
  --green:#0F7A4C;           /* header modal */
}

body{background:var(--site);}

/* area mappa fissa, niente scroll "saltellante" */
#mapBox{
  position:relative; margin:24px auto;
  width:min(1200px,96vw); height:min(720px,76vh);
  background:var(--box); border-radius:14px;
  box-shadow:0 12px 36px rgba(0,0,0,.45);
  overflow:hidden; isolation:isolate;
}

/* logo centrale retroilluminato */
#centerLogo{
  position:absolute; left:50%; top:50%; width:92px; height:92px;
  transform:translate(-50%,-50%);
  background:url('/dms-gemello-news/assets/img/logo-gov.svg') center/contain no-repeat;
  filter: drop-shadow(0 0 16px rgba(0,208,255,.55));
}
#centerLogo::after{
  content:""; position:absolute; inset:-18px;
  background:radial-gradient(55% 55% at 50% 50%, rgba(0,208,255,.20), transparent 70%);
  filter:blur(14px); pointer-events:none;
}

/* anello dei nodi */
#ring{position:absolute; inset:8% 10%; transform-origin:50% 50%; will-change:transform;}
.node{
  position:absolute; width:184px; height:98px; border-radius:16px;
  display:grid; place-items:center; text-align:center;
  background:linear-gradient(180deg,#0e2832,#0a2028);
  color:#eaf7ff; letter-spacing:.2px; font-weight:600;
  box-shadow:0 0 0 2px rgba(255,255,255,.06) inset, 0 16px 40px rgba(0,0,0,.55);
  cursor:pointer; user-select:none; -webkit-user-select:none; -webkit-touch-callout:none; touch-action:manipulation;
  transition:transform .20s ease, box-shadow .20s ease, opacity .20s ease, filter .20s ease;
}
.node::before{
  content:""; position:absolute; inset:-10px; border-radius:20px;
  background:radial-gradient(60% 80% at 50% 50%, rgba(0,208,255,.28), transparent 70%);
  filter:blur(12px); opacity:.9; pointer-events:none;
}
.node:hover{transform:scale(1.06);
  box-shadow:0 0 0 2px rgba(0,208,255,.28) inset, 0 0 46px rgba(0,208,255,.25);
}
/* mantiene il testo SEMPRE orizzontale */
.node .cap{ transform:rotate(calc(-1*var(--theta))); }

/* linee dal logo ai nodi */
#spokes{position:absolute; inset:8% 10%; pointer-events:none; opacity:.65;}

/* ricerca: evidenzia match e attenua il resto */
.node.dim{opacity:.28; filter:saturate(.6) blur(.2px);}
.node.hit{opacity:1; filter:brightness(1.2);}

/* Modal dentro il container (senza spostare la pagina) */
#modalRoot{position:absolute; left:50%; top:6%; transform:translateX(-50%); width:min(1140px,92%); z-index:30; display:none; pointer-events:none;}
#modalRoot.is-open{display:block; pointer-events:auto;}
.modal{border-radius:14px; overflow:hidden; background:#0a1a21; box-shadow:0 20px 60px rgba(0,0,0,.6);}
.modal .head{background:var(--green); color:#fff; display:flex; gap:.75rem; align-items:center; padding:.75rem 1rem;}
.modal .body{padding:1rem; color:#eaf1f5;}
.modal .btn{background:#0e2832; border:1px solid rgba(255,255,255,.12); color:#eaf7ff; border-radius:10px; padding:.5rem .75rem;}
.hidden{display:none!important}

/* iPad: blocca anteprima/drag lungo tap */
a, button, .node{ -webkit-touch-callout:none; -webkit-user-drag:none; }

/* Container fisso e contrasto */
#mapBox{
  position:relative; margin:24px auto;
  width:min(1280px,96vw); height:min(78vh,880px);
  background:#0b1f26; border-radius:16px; overflow:hidden;
  box-shadow:0 0 0 1px rgba(255,255,255,.06),0 30px 120px rgba(0,0,0,.55);
}

/* Nodo quadrato, bagliore e testo orizzontale */
.node{
  width:160px; height:88px; border-radius:16px;
  background:#162a33; color:#d7eef9; font-weight:600;
  box-shadow:0 0 0 1px rgba(255,255,255,.08),
             0 10px 35px rgba(0,206,255,.10),
             inset 0 0 28px rgba(0,206,255,.25);
  display:grid; place-items:center;
  transform:translate(-50%,-50%) rotate(var(--unrotate,0deg)); /* testo orizzontale */
  -webkit-user-select:none; user-select:none;
  -webkit-touch-callout:none; -webkit-tap-highlight-color:transparent;
}

/* Linee radiali */
#spokes{position:absolute; inset:0; pointer-events:none;}
.spoke{
  position:absolute; left:50%; top:50%; height:2px; width:42%;
  transform-origin:0 0; opacity:.65;
  background:radial-gradient(closest-side,rgba(0,206,255,.35),transparent 60%);
}

/* Logo centrale (path assoluto) */
#centerLogo{
  position:absolute; left:50%; top:50%; width:88px; height:88px;
  transform:translate(-50%,-50%);
  background:url('/dms-gemello-news/assets/img/logo-PA.svg') center/contain no-repeat;
  filter:drop-shadow(0 0 18px rgba(0,206,255,.6));
}

/* Modal chiuso di default */
.modal{display:none;}
.modal.is-open{display:block;}
</style>
</head>
<body>
  <nav class="topnav">
    <div class="nav-left">
      <a href="/dms-gemello-news/landing/home.html">Home</a>
      <a href="/dms-gemello-news/landing/mappa-ministeri.html">Mappa</a>
      <a href="/dms-gemello-news/landing/spot.html">Spot</a>
    </div>
    <div class="nav-center">
      <label class="checkbox-control">
        <input type="checkbox" id="autoRotate" checked>
        <span>Auto-rotate</span>
      </label>
      <label class="checkbox-control">
        <input type="checkbox" id="showLines" checked>
        <span>Linee</span>
      </label>
      <input type="text" id="searchMinistero" placeholder="Cerca ministero..." class="search-input">
    </div>
    <div class="nav-right">
      <span class="page-title">Mappa Ministeri (sandbox)</span>
    </div>
  </nav>

  <main id="mapWrap" aria-label="Mappa Ministeri (sandbox)">
    <div id="mapBox">
      <svg id="spokes" viewBox="0 0 1000 1000"></svg>
      <div id="ring"></div>
      <div id="centerLogo" aria-hidden="true"></div>
      <div id="modalRoot">
        <div class="modal">
          <div class="head">
            <button class="btn" id="btnBack">← Torna alla mappa</button>
            <strong id="modalTitle"></strong>
            <a class="btn" id="btnSpot" target="_self">Apri in SPOT</a>
          </div>
          <div class="body" id="modalBody"></div>
        </div>
      </div>
    </div>
  </main>

  <!-- controlli -->
  <div style="text-align:center; margin:16px 0; display:flex; gap:16px; justify-content:center; align-items:center; flex-wrap:wrap;">
    <label><input id="toggleRotate" type="checkbox" checked> Auto-rotate</label>
    <label><input id="toggleLines" type="checkbox" checked> Linee</label>
    <input id="search" placeholder="Cerca ministero…" style="padding:4px 8px; border-radius:4px; border:1px solid #333; background:#0e2230; color:#eaf7ff;">
    <input id="zoom" type="range" min="80" max="140" value="100" style="vertical-align:middle;width:160px">
  </div>

<script>
/* === DATI NODI (slug, etichetta) === */
const NODES = [
  ["agid","AgID"],["mef","MEF · Economia e Finanze"],["interno","Ministero dell'Interno"],
  ["mimit","MIMIT · Imprese e Made in Italy"],["maeci","MAECI · Affari Esteri"],["lavoro","Ministero del Lavoro"],
  ["salute","Ministero della Salute"],["mit","MIT · Infrastrutture e Trasporti"],["mase","MASE · Ambiente e Sicurezza"],
  ["mic","MIC · Cultura"],["turismo","Ministero del Turismo"],["istruzione","MIM · Istruzione e Merito"],
  ["adm","ADM · Agenzia Dogane"],["ae","AE · Agenzia Entrate"],["pagopa","PagoPA S.p.A."],["masaf","MASAF · Agricoltura"]
];

/* === NAVBAR assoluta (anti-404) === */
for(const [id,href] of [["Home","/dms-gemello-news/landing/home.html"],
                        ["Mappa","/dms-gemello-news/landing/mappa-ministeri.html"],
                        ["Spot","/dms-gemello-news/landing/spot.html"]]) {
  const a=[...document.querySelectorAll('a')].find(x=>x.textContent.trim()==id);
  if(a) a.setAttribute('href', href);
}

/* === BUILD ring === */
const ring = document.getElementById('ring');
const spokes = document.getElementById('spokes');
const center = {x:500,y:500}; // per l'SVG spokes
const R = 360;                 // raggio base
ring.innerHTML = ""; spokes.innerHTML = "";
NODES.forEach((n,i)=>{
  const d = document.createElement('div'); d.className='node'; d.dataset.slug=n[0];
  d.innerHTML = `<div class="cap">${n[1]}</div>`;
  ring.appendChild(d);
});

/* posiziona e disegna linee */
function layout(scale=1){
  const nodes = [...ring.children];
  const step = (Math.PI*2)/nodes.length;
  nodes.forEach((el,i)=>{
    const th = i*step - Math.PI/2;
    const x = 50 + (Math.cos(th)*R*scale)/ring.clientWidth*100;
    const y = 50 + (Math.sin(th)*R*scale)/ring.clientHeight*100;
    el.style.left = x+"%"; el.style.top = y+"%";
    el.style.setProperty('--theta', th+'rad');
  });
  // spokes
  const w=1000,h=1000, rSvg = 380*scale;
  spokes.setAttribute('viewBox', `0 0 ${w} ${h}`);
  spokes.innerHTML = nodes.map((_,i)=>{
    const th = i*step - Math.PI/2;
    const x = center.x + Math.cos(th)*rSvg;
    const y = center.y + Math.sin(th)*rSvg;
    return `<line x1="${center.x}" y1="${center.y}" x2="${x}" y2="${y}" stroke="rgba(0,208,255,.25)" stroke-width="2"/>`;
  }).join("");
}
layout();

/* === Auto-rotate + testo sempre orizzontale === */
let rot=0, raf=null;
function tick(){ rot = (rot+0.15)%360; ring.style.transform=`rotate(${rot}deg)`; raf=requestAnimationFrame(tick); }
document.getElementById('toggleRotate').addEventListener('change', e=>{
  if(e.target.checked){ cancelAnimationFrame(raf); raf=requestAnimationFrame(tick); }
  else { cancelAnimationFrame(raf); ring.style.transform='rotate(0deg)'; rot=0; }
});
document.getElementById('toggleRotate').checked && (raf=requestAnimationFrame(tick));

/* === Zoom (mantiene linee allineate) === */
const zoom = document.getElementById('zoom');
zoom.addEventListener('input', ()=>{ const s=zoom.value/100; ring.style.scale=s; layout(s); });

/* === Ricerca (evidenzia match) === */
const q = document.getElementById('search');
q.addEventListener('input', e=>{
  const v=e.target.value.trim().toLowerCase();
  [...ring.children].forEach(n=>{
    const hit = n.textContent.toLowerCase().includes(v);
    n.classList.toggle('hit', v && hit);
    n.classList.toggle('dim', v && !hit);
  });
});

/* === Modal dentro al container === */
const modalRoot = document.getElementById('modalRoot');
const modalTitle= document.getElementById('modalTitle');
const modalBody = document.getElementById('modalBody');
const btnSpot    = document.getElementById('btnSpot');
const btnBack    = document.getElementById('btnBack');

function openFull(slug, title){
  modalTitle.textContent = title || slug.toUpperCase();
  modalBody.textContent  = title || slug.toUpperCase();
  btnSpot.href = `/dms-gemello-news/landing/spot.html#${slug}`;
  modalRoot.classList.add('is-open');
}
function closeModal(){ modalRoot.classList.remove('is-open'); }
btnBack.addEventListener('click', closeModal);

/* click nodi ⇒ modal */
ring.addEventListener('click', e=>{
  const n = e.target.closest('.node'); if(!n) return;
  const slug=n.dataset.slug, title=n.textContent.trim();
  openFull(slug, title);
});

/* iPad: blocca menu lungo tap/anteprima */
['contextmenu','dragstart'].forEach(ev=> document.addEventListener(ev, e=>e.preventDefault(), {passive:false}));

/* === Linee ON/OFF === */
const toggleLines = document.getElementById('toggleLines');
toggleLines.addEventListener('change', e=> spokes.style.display = e.target.checked ? 'block' : 'none');
</script>

<script>
// iPad: blocca anteprime/long-press
document.addEventListener('contextmenu', e=>e.preventDefault(), {passive:false});

// Chiudi sempre il modal all'avvio
window.addEventListener('DOMContentLoaded', () => {
  const m = document.getElementById('modalRoot');
  m && m.classList.remove('is-open');
});

// Posiziona 16 nodi in corona + linee + testo orizzontale
(() => {
  const ring = document.getElementById('ring');
  const nodes = [...ring.querySelectorAll('.node')];
  const N = nodes.length || 16;
  const R = Math.min(340, Math.floor(Math.min(ring.clientWidth, ring.clientHeight)*0.36));
  nodes.forEach((el,i)=>{
    const deg = (360/N)*i;
    const rad = deg*Math.PI/180;
    el.style.left  = `calc(50% + ${R*Math.cos(rad)}px)`;
    el.style.top   = `calc(50% + ${R*Math.sin(rad)}px)`;
    el.style.setProperty('--unrotate', `-${deg}deg`);   // testo orizzontale
  });

  const spokes = document.getElementById('spokes');
  spokes.innerHTML = '';
  for(let i=0;i<N;i++){
    const d = document.createElement('div');
    d.className='spoke';
    d.style.transform = `rotate(${(360/N)*i}deg)`;
    spokes.appendChild(d);
  }
})();
</script>
</body>
</html>

