<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DMS · Gemello Digitale — Mappa Ministeri</title>
  <style>
:root{ --green:#0F7A4C; --bg:#0b1418; --card:#0f2026; --ink:#dff7ff; font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif }
body{ margin:0; background:#071319; color:var(--ink) }

/* Barra superiore con controlli */
.topnav{ 
  display:flex; justify-content:space-between; align-items:center; 
  gap:.75rem; padding:.6rem 1rem; background:#081319; position:sticky; top:0; z-index:5;
  flex-wrap: wrap;
}
.nav-left{ display:flex; gap:.75rem; }
.nav-left a{ color:#cfefff; text-decoration:none; padding:.35rem .7rem; border-radius:8px; background:#0e2230 }
.nav-center{ display:flex; gap:1rem; align-items:center; flex-wrap:wrap; }
.checkbox-control{ display:flex; align-items:center; gap:.4rem; color:#cfefff; cursor:pointer; }
.checkbox-control input[type="checkbox"]{ margin:0; }
.search-input{ 
  padding:.35rem .7rem; border-radius:8px; border:1px solid #0e2230; 
  background:#0e2230; color:#cfefff; min-width:180px;
}
.search-input::placeholder{ color:#8bb5c5; }
.nav-right .page-title{ color:#cfefff; font-weight:600; }

/* Contenitore fisso stile sito, niente pinch-zoom che sposta tutto */
#mapWrap{ padding:1.25rem; display:grid; place-items:center; }
#mapStage{
  width: min(1140px, 92vw);
  height: min(720px, calc(92vw * 0.63));
  margin: 32px auto 64px;
  position: relative;
  background: radial-gradient(120% 120% at 50% 40%, #0d2026 0%, #08171c 55%, #081318 100%);
  border-radius: 16px;
  box-shadow: 0 8px 32px rgba(0,0,0,.45), inset 0 0 0 1px rgba(255,255,255,.06);
  overflow: hidden;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  user-select: none;
  touch-action: manipulation;
}

/* Ring che ruota */
.ring{
  position: absolute; inset: 0;
  transform-origin: 50% 55%;
}
@keyframes spin { from{transform: rotate(0deg)} to{transform: rotate(360deg)} }
.ring.auto-rotate{ animation: spin 56s linear infinite; }

/* Nodi – rettangolari grandi con retro-illuminazione */
.node-btn{
  position: absolute; 
  width: 164px; height: 104px;
  border: 0; border-radius: 18px;
  background: rgba(18,38,46,.82);
  color: #d7eef5; font-weight: 700; line-height: 1.2; font-size: 0.9rem;
  box-shadow:
    inset 0 0 0 2px rgba(255,255,255,.08),
    0 8px 18px rgba(0,200,255,.12),
    0 0 24px rgba(0,200,255,.15);
  text-shadow: 0 0 8px rgba(0,200,255,.35);
  backdrop-filter: blur(2px);
  display: grid; place-items: center; padding: 10px;
  cursor: pointer;
  outline: none;
  transform: translate(-50%, -50%) rotate(calc(-1 * var(--deg)));
  transition: transform .18s ease, box-shadow .18s ease, background .18s ease, opacity .18s ease;
}
.node-btn:hover, .node-btn:focus-visible{
  background: rgba(20,48,56,.92);
  box-shadow:
    inset 0 0 0 2px #3ad6ff,
    0 14px 26px rgba(0,210,255,.28),
    0 0 42px rgba(0,210,255,.35);
  transform: translate(-50%, -50%) rotate(calc(-1 * var(--deg))) scale(1.045);
}

/* Ricerca: match evidenziato, altri attenuati */
.node-btn.dimmed { opacity:.22; filter:saturate(.5) blur(.1px); }
.node-btn.highlight { opacity:1; filter:none; }

/* Logo centrale con glow */
#logo{
  position:absolute; left:50%; top:55%;
  transform: translate(-50%,-50%);
  filter: drop-shadow(0 0 28px rgba(0,178,255,.42)) drop-shadow(0 0 68px rgba(0,178,255,.22));
}
#hubIcon{
  width: 120px; height: 120px;
  background:
    radial-gradient(60% 60% at 50% 50%, rgba(56,189,248,.22), transparent 65%),
    url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" fill="%23e6f7ff" stroke="%2300b3ff" stroke-width="14"><path d="M20 230h600L320 80 20 230zM80 260h80v260H80V260zm120 0h120v260H200V260zm160 0h120v260H360V260zm160 0h80v260h-80V260zM40 540h560v30H40z"/></svg>')
    center/72% no-repeat;
  border-radius: 50%;
}

/* MODAL */
#modalRoot{ position:fixed; inset:0; display:none; pointer-events:none; z-index:1100 }
#modalRoot.is-open{ display:block; pointer-events:auto }
#modalRoot .overlay{ position:absolute; inset:0; background:rgba(0,0,0,.6) }
.modalCard{ position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);
  width: min(92vw, 1140px); background:var(--card); border-radius:14px; overflow:hidden; }
#modalHeader{ background:var(--green) !important; color:#fff; display:flex; gap:.75rem; align-items:center; padding:.7rem 1rem }
#modalHeader h3{ margin:0; font-weight:700; flex:1 }
#modalHeader .back{ background:#0b5f3a; color:#fff; border:0; border-radius:8px; padding:.35rem .6rem; cursor:pointer }
#spotBtns a{ background:#0e2230; color:#fff; text-decoration:none; border-radius:8px; padding:.35rem .6rem; margin-left:.4rem }
#modalBody{ padding:1rem; background:#0b161b }
.doc{ margin:0 0 1rem 0; }
.doc img{ width:100%; height:auto; display:block; border-radius:10px }
#modalRoot:not(.is-open) *{ pointer-events:none }

/* === Ottimizzazioni iPad/Tablet === */
@media screen and (min-width: 768px) and (max-width: 1024px) {
  /* Mappa più grande su tablet */
  #mapStage{ width: min(90vw, 800px); }
  
  /* Nodi leggermente più grandi per touch */
  .node-btn{ 
    width: 180px; height: 110px;
    padding: .6rem .9rem; 
    font-size: 0.95rem;
    min-height: 44px; /* Apple touch target size */
    min-width: 44px;
  }
  
  /* Modal ottimizzato per tablet */
  .modalCard{ 
    width: min(95vw, 900px); 
    max-height: 85vh;
    overflow-y: auto;
  }
  
  #modalBody{ 
    padding: 1.2rem; 
    max-height: calc(85vh - 80px);
    overflow-y: auto;
  }
  
  /* Header modal più spazioso */
  #modalHeader{ padding: .8rem 1.2rem; }
  #modalHeader .back{ padding: .4rem .8rem; }
  
  /* Navigazione top più spaziosa */
  .topnav{ padding: .8rem 1.2rem; }
  .nav-left a{ padding: .4rem .8rem; }
}

/* iPad Portrait specifico */
@media screen and (width: 768px) and (height: 1024px) and (orientation: portrait) {
  #mapStage{ width: min(85vw, 700px); }
  .modalCard{ width: min(92vw, 700px); }
}

/* iPad Landscape specifico */
@media screen and (width: 1024px) and (height: 768px) and (orientation: landscape) {
  #mapStage{ width: min(80vw, 750px); }
  .modalCard{ width: min(90vw, 850px); }
}

/* Touch improvements per tutti i dispositivi touch */
@media (hover: none) and (pointer: coarse) {
  .node-btn{ 
    /* Rimuovi hover effects su touch, usa solo focus */
    transition: box-shadow .22s ease, filter .18s ease, opacity .18s ease, transform .15s ease;
  }
  
  .node-btn:active{ 
    transform: translate(-50%, -50%) rotate(calc(-1 * var(--deg))) scale(0.98);
    filter: brightness(.96); 
  }
  
  /* Pulsanti più grandi per touch */
  #modalHeader .back,
  .nav-left a{ 
    min-height: 44px;
    min-width: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
  }
}

/* Responsive navigation */
@media (max-width: 768px) {
  .topnav{ flex-direction: column; gap: .5rem; }
  .nav-center{ order: 2; }
  .nav-right{ order: 3; }
  .search-input{ min-width: 150px; }
</style>
</head>
<body>
  <nav class="topnav">
    <div class="nav-left">
      <a href="/dms-gemello-news/landing/home.html">Home</a>
      <a href="/dms-gemello-news/landing/mappa-ministeri.html">Mappa</a>
      <a href="/dms-gemello-news/landing/spot.html">Spot</a>
    </div>
    <div class="nav-center">
      <label class="checkbox-control">
        <input type="checkbox" id="autoRotate" checked>
        <span>Auto-rotate</span>
      </label>
      <label class="checkbox-control">
        <input type="checkbox" id="showLines" checked>
        <span>Linee</span>
      </label>
      <input type="text" id="searchMinistero" placeholder="Cerca ministero..." class="search-input">
    </div>
    <div class="nav-right">
      <span class="page-title">Mappa Ministeri (sandbox)</span>
    </div>
  </nav>

  <main id="mapWrap" aria-label="Mappa Ministeri (sandbox)">
    <div id="mapStage">
      <div id="ring" class="ring auto-rotate" aria-live="polite">
        <!-- Logo centrale con glow -->
        <div id="logo" aria-hidden="true">
          <div id="hubIcon"></div>
        </div>
        <!-- 16 nodi rettangolari con testi completi -->
        <button class="node-btn" data-slug="agid"><span>AgID</span></button>
        <button class="node-btn" data-slug="mef"><span>MEF · Economia e Finanze</span></button>
        <button class="node-btn" data-slug="interno"><span>Ministero dell'Interno</span></button>
        <button class="node-btn" data-slug="mimit"><span>MIMIT · Imprese e Made in Italy</span></button>
        <button class="node-btn" data-slug="mase"><span>MASE · Ambiente e Sicurezza</span></button>
        <button class="node-btn" data-slug="mit"><span>MIT · Infrastrutture e Trasporti</span></button>
        <button class="node-btn" data-slug="salute"><span>Ministero della Salute</span></button>
        <button class="node-btn" data-slug="mic"><span>MIC · Cultura</span></button>
        <button class="node-btn" data-slug="turismo"><span>Ministero del Turismo</span></button>
        <button class="node-btn" data-slug="masaf"><span>MASAF · Agricoltura</span></button>
        <button class="node-btn" data-slug="mim"><span>MIM · Istruzione e Merito</span></button>
        <button class="node-btn" data-slug="lavoro"><span>Ministero del Lavoro</span></button>
        <button class="node-btn" data-slug="maeci"><span>MAECI · Affari Esteri</span></button>
        <button class="node-btn" data-slug="pagopa"><span>PagoPA S.p.A.</span></button>
        <button class="node-btn" data-slug="ae"><span>AE · Agenzia Entrate</span></button>
        <button class="node-btn" data-slug="adm"><span>ADM · Agenzia Dogane</span></button>
      </div>
    </div>
  </main>

  <!-- MODAL -->
  <div id="modalRoot" aria-hidden="true">
    <div class="overlay" role="presentation"></div>
    <div class="modalCard" role="dialog" aria-modal="true">
      <header id="modalHeader">
        <button id="btnBack" class="back">← Torna alla mappa</button>
        <h3 id="modalTitle"></h3>
        <div id="spotBtns"></div>
      </header>
      <section id="modalBody" aria-live="polite"></section>
    </div>
  </div>

<script>
/* Dati semplici (più item = più schede impilate) */
window.DOC_MAP = {
  agid   : { title:"AgID",                            cards:[{img:"/dms-gemello-news/assets/doc/agid.jpg",    alt:"AgID"}] },
  mef    : { title:"MEF - Economia e Finanze",        cards:[{img:"/dms-gemello-news/assets/doc/mef.jpg",     alt:"MEF"}] },
  interno: { title:"Ministero dell'Interno",          cards:[{img:"/dms-gemello-news/assets/doc/interno.jpg", alt:"Interno"}] },
  salute : { title:"Ministero della Salute",          cards:[{img:"/dms-gemello-news/assets/doc/salute.jpg",  alt:"Salute"}] },
  turismo: { title:"Ministero del Turismo",           cards:[{img:"/dms-gemello-news/assets/doc/turismo.jpg", alt:"Turismo"}] },
  lavoro : { title:"Ministero del Lavoro",            cards:[{img:"/dms-gemello-news/assets/doc/lavoro.jpg",  alt:"Lavoro"}] },
  mit    : { title:"MIT - Infrastrutture e Trasporti",cards:[{img:"/dms-gemello-news/assets/doc/mit.jpg",     alt:"MIT"}] },
  mim    : { title:"MIM - Istruzione e Merito",       cards:[{img:"/dms-gemello-news/assets/doc/mim.jpg",     alt:"MIM"}] },
  mimit  : { title:"MIMIT - Imprese e Made in Italy", cards:[{img:"/dms-gemello-news/assets/doc/mimit.jpg",   alt:"MIMIT"}] },
  mase   : { title:"MASE - Ambiente e Sicurezza",     cards:[{img:"/dms-gemello-news/assets/doc/mase.jpg",    alt:"MASE"}] },
  masaf  : { title:"MASAF - Agricoltura",             cards:[{img:"/dms-gemello-news/assets/doc/masaf.jpg",   alt:"MASAF"}] },
  maeci  : { title:"MAECI - Affari Esteri",           cards:[{img:"/dms-gemello-news/assets/doc/maeci.jpg",   alt:"MAECI"}] },
  mic    : { title:"MIC - Cultura",                   cards:[{img:"/dms-gemello-news/assets/doc/mic.jpg",     alt:"MIC"}] },
  ae     : { title:"Agenzia Entrate",                 cards:[{img:"/dms-gemello-news/assets/doc/ae.jpg",      alt:"AE"}] },
  adm    : { title:"Agenzia Dogane",                  cards:[{img:"/dms-gemello-news/assets/doc/adm.jpg",     alt:"ADM"}] },
  pagopa : { title:"PagoPA S.p.A.",                   cards:[{img:"/dms-gemello-news/assets/doc/pagopa.jpg",  alt:"PagoPA"}] }
};

const $ = s => document.querySelector(s);
const root = $('#modalRoot'), title = $('#modalTitle'), body = $('#modalBody'), spot = $('#spotBtns');

function renderSpotButtons(slug){
  const href = `/dms-gemello-news/landing/spot.html#${slug}`;
  spot.innerHTML = `<a href="${href}">Apri in SPOT</a>`;
}
function renderDocs(cards){
  body.innerHTML = cards.map(c=>`<figure class="doc"><img src="${c.img}" alt="${c.alt||''}"></figure>`).join('');
}
function openFull(slug){
  const d = window.DOC_MAP[slug]; if(!d) return;
  title.textContent = d.title;
  renderSpotButtons(slug);
  renderDocs(d.cards||[]);
  root.classList.add('is-open');
  root.setAttribute('aria-hidden','false');
  if(location.hash.slice(1)!==slug) location.hash = slug;
}
function closeModal(updateHash=true){
  root.classList.remove('is-open');
  root.setAttribute('aria-hidden','true');
  if(updateHash) history.replaceState(null,'', location.pathname);
}

// === Nuovo sistema di posizionamento corona e interazioni ===
(() => {
  const IDS = [
    'agid','mef','interno','mimit','mase','mit','salute','mic',
    'turismo','masaf','mim','lavoro','maeci','pagopa','ae','adm'
  ];
  const ring = document.querySelector('#ring');
  const nodes = [...ring.querySelectorAll('.node-btn')];

  // Disposizione in corona e contatore rotazione testo
  function layout(){
    const stage = document.querySelector('#mapStage');
    const w = stage.clientWidth, h = stage.clientHeight;
    const cx = w/2, cy = h*0.55;                  // centro visivo leggermente più in alto
    const R = Math.min(w,h) * 0.36;               // raggio responsive
    nodes.forEach((el,i) => {
      const theta = (i / nodes.length) * Math.PI*2;
      const x = cx + R * Math.cos(theta);
      const y = cy + R * Math.sin(theta);
      el.style.left = x + 'px';
      el.style.top  = y + 'px';
      el.style.setProperty('--deg', (theta * 180/Math.PI) + 'deg');
    });
  }
  layout(); 
  addEventListener('resize', layout);

  // Click -> openFull con slug
  nodes.forEach(btn => {
    btn.addEventListener('click', () => {
      const slug = btn.dataset.slug;
      if (window.openFull) window.openFull(slug);
      else location.hash = slug; // fallback
    });
  });

  // Ricerca live (se c'è l'input)
  const q = document.querySelector('#searchMinistero');
  if (q){
    q.addEventListener('input', () => {
      const term = q.value.trim().toLowerCase();
      nodes.forEach(b => {
        const match = !term || b.textContent.toLowerCase().includes(term);
        b.classList.toggle('highlight', match);
        b.classList.toggle('dimmed', !match);
      });
    });
  }

  // Controlli Auto-rotate e Linee
  const autoRotateCheckbox = document.querySelector('#autoRotate');
  const showLinesCheckbox = document.querySelector('#showLines');
  
  if (autoRotateCheckbox) {
    autoRotateCheckbox.addEventListener('change', () => {
      ring.classList.toggle('auto-rotate', autoRotateCheckbox.checked);
    });
  }
  
  if (showLinesCheckbox) {
    showLinesCheckbox.addEventListener('change', () => {
      // Implementazione linee di connessione (placeholder)
      console.log('Linee:', showLinesCheckbox.checked ? 'ON' : 'OFF');
    });
  }

  // iPad: niente selezione/long-press preview
  document.addEventListener('touchstart', () => {}, {passive:true});
})();

// Inizializzazione al caricamento
document.addEventListener('DOMContentLoaded',()=>{
  closeModal(false);
  $('#btnBack').addEventListener('click',()=>closeModal());
  document.addEventListener('keydown',e=>{ if(e.key==='Escape') closeModal(); });
  const s = location.hash.slice(1); if(window.DOC_MAP[s]) openFull(s);
});

window.addEventListener('hashchange',()=>{
  const s = location.hash.slice(1);
  if(window.DOC_MAP[s]) openFull(s); else closeModal(false);
});
</script>
</body>
</html>

